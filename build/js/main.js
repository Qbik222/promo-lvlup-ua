"use strict";

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
document.addEventListener("DOMContentLoaded", function () {
  var slides = document.querySelectorAll(".slide");
  var leftBtn = document.querySelector(".slide__move-left");
  var rightBtn = document.querySelector(".slide__move-right");
  var slidesIcons = document.querySelectorAll(".quests__icons-item");
  var glitchLayers = [];
  var current = 1;
  // let week = 2;
  var week = localStorage.getItem("week") ? parseInt(localStorage.getItem("week")) : 1;
  if (week === 1) {
    slides.forEach(function (slide, i) {
      if (i >= 6 || slide.classList.contains("quest".concat(i))) {
        slide.remove();
      }
    });
    slidesIcons.forEach(function (icon, i) {
      if (i >= 6 || icon.classList.contains("quest".concat(i))) {
        icon.remove();
      }
    });
  }
  if (week === 2) {
    for (var i = 1; i <= 6; i++) {
      var _week = document.querySelectorAll(".quest".concat(i));
      _week.forEach(function (item) {
        item.remove();
      });
    }
  }
  slides.forEach(function (slide) {
    glitchLayers = [].concat(_toConsumableArray(glitchLayers), _toConsumableArray(slide.querySelectorAll(".glitch__layer")));
  });
  slides[current].classList.add("_active");
  function updateGlitchLayers(index) {
    if (week === 2) {
      index += 6;
    }
    glitchLayers.forEach(function (layer) {
      layer.classList.forEach(function (className) {
        if (className.startsWith("slide-info-glitch")) {
          layer.classList.remove("slide-info-glitch");
        }
        if (className.startsWith("quest")) {
          layer.classList.remove(className);
        }
      });
      if (layer.parentElement.parentElement.classList[0] !== "slide__info") {
        layer.classList.add("quest".concat(index));
        layer.style.background = "url(\"./img/quests/slide".concat(index, "/pers.png\") no-repeat 0 0/contain");
      } else {
        layer.classList.add("slide-info-glitch");
      }
    });
  }
  function moveSlider(slides, direction) {
    if (direction === "left") {
      --current;
      if (current < 0) current = slides.length - 1;
    } else if (direction === "right") {
      ++current;
      if (current > slides.length - 1) current = 0;
    }
    slides.forEach(function (slide, i) {
      slide.classList.toggle("_active", i === current);
      slide.classList.remove("glitch");
    });
    SlideIconsInit(slidesIcons, current);
  }
  function SlideIconsInit(icons, current) {
    icons.forEach(function (icon, iconIndex) {
      icon.classList.toggle("_current", current === iconIndex);
    });
  }
  function handleClick(direction) {
    slides[current].classList.add("glitch");
    rightBtn.style.pointerEvents = "none";
    leftBtn.style.pointerEvents = "none";
    var nextSlideIndex = direction === "left" ? current === 0 ? slides.length : current : current === slides.length - 1 ? 1 : current + 2;
    updateGlitchLayers(nextSlideIndex);
    setTimeout(function () {
      glitchLayers.forEach(function (layer) {
        layer.classList.forEach(function (className) {
          if (className.startsWith("slide-info-glitch") || className.startsWith("quest")) {
            layer.classList.remove(className);
          }
        });
      });
      moveSlider(slides, direction);
      rightBtn.style.pointerEvents = "initial";
      leftBtn.style.pointerEvents = "initial";
    }, 1000);
  }
  leftBtn.addEventListener("click", function () {
    return handleClick("left");
  });
  rightBtn.addEventListener("click", function () {
    return handleClick("right");
  });
  slidesIcons.forEach(function (icon, i) {
    icon.addEventListener("click", function () {
      setTimeout(function () {
        slidesIcons.forEach(function (item) {
          return item.classList.remove("_current");
        });
      }, 1000);
      slides[current].classList.add("glitch");
      current = i;
      updateGlitchLayers(current + 1);
      setTimeout(function () {
        SlideIconsInit(slidesIcons, current);
        slides.forEach(function (slide, index) {
          slide.classList.toggle("_active", index === current);
          slide.classList.remove("glitch");
        });
        rightBtn.style.pointerEvents = "initial";
        leftBtn.style.pointerEvents = "initial";
      }, 1000);
    });
  });
  SlideIconsInit(slidesIcons, current);
  document.addEventListener("DOMContentLoaded", function () {
    var slides = document.querySelectorAll(".slide");
    var leftBtn = document.querySelector(".slide__move-left");
    var rightBtn = document.querySelector(".slide__move-right");
    var slidesIcons = document.querySelectorAll(".quests__icons-item");
    var glitchLayers = [];
    var current = 1;
    // let week = 2;
    var week = localStorage.getItem("week") ? parseInt(localStorage.getItem("week")) : 1;
    if (week === 1) {
      slides.forEach(function (slide, i) {
        if (i >= 6 || slide.classList.contains("quest".concat(i))) {
          slide.remove();
        }
      });
      slidesIcons.forEach(function (icon, i) {
        if (i >= 6 || icon.classList.contains("quest".concat(i))) {
          icon.remove();
        }
      });
    }
    if (week === 2) {
      for (var _i = 1; _i <= 6; _i++) {
        var _week2 = document.querySelectorAll(".quest".concat(_i));
        _week2.forEach(function (item) {
          item.remove();
        });
      }
    }
    slides.forEach(function (slide) {
      glitchLayers = [].concat(_toConsumableArray(glitchLayers), _toConsumableArray(slide.querySelectorAll(".glitch__layer")));
    });
    slides[current].classList.add("_active");
    function updateGlitchLayers(index) {
      if (week === 2) {
        index += 6;
      }
      glitchLayers.forEach(function (layer) {
        layer.classList.forEach(function (className) {
          if (className.startsWith("slide-info-glitch")) {
            layer.classList.remove("slide-info-glitch");
          }
          if (className.startsWith("quest")) {
            layer.classList.remove(className);
          }
        });
        if (layer.parentElement.parentElement.classList[0] !== "slide__info") {
          layer.classList.add("quest".concat(index));
          layer.style.background = "url(\"./img/quests/slide".concat(index, "/pers.png\") no-repeat 0 0/contain");
        } else {
          layer.classList.add("slide-info-glitch");
        }
      });
    }
    function moveSlider(slides, direction) {
      if (direction === "left") {
        --current;
        if (current < 0) current = slides.length - 1;
      } else if (direction === "right") {
        ++current;
        if (current > slides.length - 1) current = 0;
      }
      slides.forEach(function (slide, i) {
        slide.classList.toggle("_active", i === current);
        slide.classList.remove("glitch");
      });
      SlideIconsInit(slidesIcons, current);
    }
    function SlideIconsInit(icons, current) {
      icons.forEach(function (icon, iconIndex) {
        icon.classList.toggle("_current", current === iconIndex);
      });
    }
    function handleClick(direction) {
      slides[current].classList.add("glitch");
      rightBtn.style.pointerEvents = "none";
      leftBtn.style.pointerEvents = "none";
      var nextSlideIndex = direction === "left" ? current === 0 ? slides.length : current : current === slides.length - 1 ? 1 : current + 2;
      updateGlitchLayers(nextSlideIndex);
      setTimeout(function () {
        glitchLayers.forEach(function (layer) {
          layer.classList.forEach(function (className) {
            if (className.startsWith("slide-info-glitch") || className.startsWith("quest")) {
              layer.classList.remove(className);
            }
          });
        });
        moveSlider(slides, direction);
        rightBtn.style.pointerEvents = "initial";
        leftBtn.style.pointerEvents = "initial";
      }, 1000);
    }
    leftBtn.addEventListener("click", function () {
      return handleClick("left");
    });
    rightBtn.addEventListener("click", function () {
      return handleClick("right");
    });
    slidesIcons.forEach(function (icon, i) {
      icon.addEventListener("click", function () {
        setTimeout(function () {
          slidesIcons.forEach(function (item) {
            return item.classList.remove("_current");
          });
        }, 1000);
        slides[current].classList.add("glitch");
        current = i;
        updateGlitchLayers(current + 1);
        setTimeout(function () {
          SlideIconsInit(slidesIcons, current);
          slides.forEach(function (slide, index) {
            slide.classList.toggle("_active", index === current);
            slide.classList.remove("glitch");
          });
          rightBtn.style.pointerEvents = "initial";
          leftBtn.style.pointerEvents = "initial";
        }, 1000);
      });
    });
    SlideIconsInit(slidesIcons, current);

    // for test

    var week1 = document.querySelector(".week1");
    var week2 = document.querySelector(".week2");
    week1.addEventListener("click", function () {
      localStorage.setItem("week", 1);
      location.reload();
    });
    week2.addEventListener("click", function () {
      localStorage.setItem("week", 2);
      location.reload();
    });
  });
  function preloadImages() {
    for (var _i2 = 1; _i2 <= 12; _i2++) {
      var pers = new Image();
      var persMob = new Image();
      var slideBg = new Image();
      var slideBgMob = new Image();
      pers.src = "./img/quests/slide".concat(_i2, "/pers.png");
      persMob.src = "./img/quests/slide".concat(_i2, "/pers-mob.png");
      slideBg.src = "./img/quests/slide".concat(_i2, "/slide-bg.png");
      slideBgMob.src = "./img/quests/slide".concat(_i2, "/slide-bg-mob.png");
    }
  }
  preloadImages();

  // for test

  var week1 = document.querySelector(".week1");
  var week2 = document.querySelector(".week2");
  week1.addEventListener("click", function () {
    localStorage.setItem("week", 1);
    location.reload();
  });
  week2.addEventListener("click", function () {
    localStorage.setItem("week", 2);
    location.reload();
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwic2xpZGVzIiwicXVlcnlTZWxlY3RvckFsbCIsImxlZnRCdG4iLCJxdWVyeVNlbGVjdG9yIiwicmlnaHRCdG4iLCJzbGlkZXNJY29ucyIsImdsaXRjaExheWVycyIsImN1cnJlbnQiLCJ3ZWVrIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInBhcnNlSW50IiwiZm9yRWFjaCIsInNsaWRlIiwiaSIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwicmVtb3ZlIiwiaWNvbiIsIndlZWsxIiwiaXRlbSIsImFkZCIsInVwZGF0ZUdsaXRjaExheWVycyIsImluZGV4IiwibGF5ZXIiLCJjbGFzc05hbWUiLCJzdGFydHNXaXRoIiwicGFyZW50RWxlbWVudCIsInN0eWxlIiwiYmFja2dyb3VuZCIsIm1vdmVTbGlkZXIiLCJkaXJlY3Rpb24iLCJsZW5ndGgiLCJ0b2dnbGUiLCJTbGlkZUljb25zSW5pdCIsImljb25zIiwiaWNvbkluZGV4IiwiaGFuZGxlQ2xpY2siLCJwb2ludGVyRXZlbnRzIiwibmV4dFNsaWRlSW5kZXgiLCJzZXRUaW1lb3V0Iiwid2VlazIiLCJzZXRJdGVtIiwibG9jYXRpb24iLCJyZWxvYWQiLCJwcmVsb2FkSW1hZ2VzIiwicGVycyIsIkltYWdlIiwicGVyc01vYiIsInNsaWRlQmciLCJzbGlkZUJnTW9iIiwic3JjIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBQSxRQUFRLENBQUNDLGdCQUFnQixDQUFDLGtCQUFrQixFQUFFLFlBQUs7RUFJL0MsSUFBTUMsTUFBTSxHQUFHRixRQUFRLENBQUNHLGdCQUFnQixDQUFDLFFBQVEsQ0FBQztFQUNsRCxJQUFNQyxPQUFPLEdBQUdKLFFBQVEsQ0FBQ0ssYUFBYSxDQUFDLG1CQUFtQixDQUFDO0VBQzNELElBQU1DLFFBQVEsR0FBR04sUUFBUSxDQUFDSyxhQUFhLENBQUMsb0JBQW9CLENBQUM7RUFDN0QsSUFBTUUsV0FBVyxHQUFHUCxRQUFRLENBQUNHLGdCQUFnQixDQUFDLHFCQUFxQixDQUFDO0VBRXBFLElBQUlLLFlBQVksR0FBRyxFQUFFO0VBQ3JCLElBQUlDLE9BQU8sR0FBRyxDQUFDO0VBQ2Y7RUFDQSxJQUFJQyxJQUFJLEdBQUdDLFlBQVksQ0FBQ0MsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHQyxRQUFRLENBQUNGLFlBQVksQ0FBQ0MsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQztFQUVwRixJQUFHRixJQUFJLEtBQUssQ0FBQyxFQUFDO0lBQ1ZSLE1BQU0sQ0FBQ1ksT0FBTyxDQUFDLFVBQUNDLEtBQUssRUFBRUMsQ0FBQyxFQUFJO01BRXhCLElBQUdBLENBQUMsSUFBSSxDQUFDLElBQUlELEtBQUssQ0FBQ0UsU0FBUyxDQUFDQyxRQUFRLGdCQUFTRixDQUFDLEVBQUcsRUFBQztRQUMvQ0QsS0FBSyxDQUFDSSxNQUFNLEVBQUU7TUFDbEI7SUFDSixDQUFDLENBQUM7SUFDRlosV0FBVyxDQUFDTyxPQUFPLENBQUMsVUFBQ00sSUFBSSxFQUFFSixDQUFDLEVBQUk7TUFDNUIsSUFBR0EsQ0FBQyxJQUFJLENBQUMsSUFBSUksSUFBSSxDQUFDSCxTQUFTLENBQUNDLFFBQVEsZ0JBQVNGLENBQUMsRUFBRyxFQUFDO1FBQzlDSSxJQUFJLENBQUNELE1BQU0sRUFBRTtNQUNqQjtJQUNKLENBQUMsQ0FBQztFQUNOO0VBQ0EsSUFBR1QsSUFBSSxLQUFLLENBQUMsRUFBQztJQUNWLEtBQUssSUFBSU0sQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxJQUFJLENBQUMsRUFBRUEsQ0FBQyxFQUFFLEVBQUM7TUFDeEIsSUFBSUssS0FBSyxHQUFHckIsUUFBUSxDQUFDRyxnQkFBZ0IsaUJBQVVhLENBQUMsRUFBRztNQUNuREssS0FBSyxDQUFDUCxPQUFPLENBQUMsVUFBQVEsSUFBSSxFQUFJO1FBQ2xCQSxJQUFJLENBQUNILE1BQU0sRUFBRTtNQUNqQixDQUFDLENBQUM7SUFFTjtFQUNKO0VBRUFqQixNQUFNLENBQUNZLE9BQU8sQ0FBQyxVQUFBQyxLQUFLLEVBQUk7SUFDcEJQLFlBQVksZ0NBQU9BLFlBQVksc0JBQUtPLEtBQUssQ0FBQ1osZ0JBQWdCLENBQUMsZ0JBQWdCLENBQUMsRUFBQztFQUNqRixDQUFDLENBQUM7RUFFRkQsTUFBTSxDQUFDTyxPQUFPLENBQUMsQ0FBQ1EsU0FBUyxDQUFDTSxHQUFHLENBQUMsU0FBUyxDQUFDO0VBRXhDLFNBQVNDLGtCQUFrQixDQUFDQyxLQUFLLEVBQUU7SUFDL0IsSUFBR2YsSUFBSSxLQUFLLENBQUMsRUFBQztNQUNWZSxLQUFLLElBQUksQ0FBQztJQUNkO0lBQ0FqQixZQUFZLENBQUNNLE9BQU8sQ0FBQyxVQUFBWSxLQUFLLEVBQUk7TUFDMUJBLEtBQUssQ0FBQ1QsU0FBUyxDQUFDSCxPQUFPLENBQUMsVUFBQWEsU0FBUyxFQUFJO1FBQ2pDLElBQUlBLFNBQVMsQ0FBQ0MsVUFBVSxDQUFDLG1CQUFtQixDQUFDLEVBQUU7VUFDM0NGLEtBQUssQ0FBQ1QsU0FBUyxDQUFDRSxNQUFNLENBQUMsbUJBQW1CLENBQUM7UUFDL0M7UUFDQSxJQUFJUSxTQUFTLENBQUNDLFVBQVUsQ0FBQyxPQUFPLENBQUMsRUFBRTtVQUMvQkYsS0FBSyxDQUFDVCxTQUFTLENBQUNFLE1BQU0sQ0FBQ1EsU0FBUyxDQUFDO1FBQ3JDO01BQ0osQ0FBQyxDQUFDO01BQ0YsSUFBSUQsS0FBSyxDQUFDRyxhQUFhLENBQUNBLGFBQWEsQ0FBQ1osU0FBUyxDQUFDLENBQUMsQ0FBQyxLQUFLLGFBQWEsRUFBRTtRQUNsRVMsS0FBSyxDQUFDVCxTQUFTLENBQUNNLEdBQUcsZ0JBQVNFLEtBQUssRUFBRztRQUNwQ0MsS0FBSyxDQUFDSSxLQUFLLENBQUNDLFVBQVUscUNBQTZCTixLQUFLLHVDQUFtQztNQUMvRixDQUFDLE1BQU07UUFDSEMsS0FBSyxDQUFDVCxTQUFTLENBQUNNLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQztNQUM1QztJQUNKLENBQUMsQ0FBQztFQUNOO0VBRUEsU0FBU1MsVUFBVSxDQUFDOUIsTUFBTSxFQUFFK0IsU0FBUyxFQUFFO0lBQ25DLElBQUlBLFNBQVMsS0FBSyxNQUFNLEVBQUU7TUFDdEIsRUFBRXhCLE9BQU87TUFDVCxJQUFJQSxPQUFPLEdBQUcsQ0FBQyxFQUFFQSxPQUFPLEdBQUdQLE1BQU0sQ0FBQ2dDLE1BQU0sR0FBRyxDQUFDO0lBQ2hELENBQUMsTUFBTSxJQUFJRCxTQUFTLEtBQUssT0FBTyxFQUFFO01BQzlCLEVBQUV4QixPQUFPO01BQ1QsSUFBSUEsT0FBTyxHQUFHUCxNQUFNLENBQUNnQyxNQUFNLEdBQUcsQ0FBQyxFQUFFekIsT0FBTyxHQUFHLENBQUM7SUFDaEQ7SUFFQVAsTUFBTSxDQUFDWSxPQUFPLENBQUMsVUFBQ0MsS0FBSyxFQUFFQyxDQUFDLEVBQUs7TUFDekJELEtBQUssQ0FBQ0UsU0FBUyxDQUFDa0IsTUFBTSxDQUFDLFNBQVMsRUFBRW5CLENBQUMsS0FBS1AsT0FBTyxDQUFDO01BQ2hETSxLQUFLLENBQUNFLFNBQVMsQ0FBQ0UsTUFBTSxDQUFDLFFBQVEsQ0FBQztJQUNwQyxDQUFDLENBQUM7SUFFRmlCLGNBQWMsQ0FBQzdCLFdBQVcsRUFBRUUsT0FBTyxDQUFDO0VBQ3hDO0VBRUEsU0FBUzJCLGNBQWMsQ0FBQ0MsS0FBSyxFQUFFNUIsT0FBTyxFQUFFO0lBQ3BDNEIsS0FBSyxDQUFDdkIsT0FBTyxDQUFDLFVBQUNNLElBQUksRUFBRWtCLFNBQVMsRUFBSztNQUMvQmxCLElBQUksQ0FBQ0gsU0FBUyxDQUFDa0IsTUFBTSxDQUFDLFVBQVUsRUFBRTFCLE9BQU8sS0FBSzZCLFNBQVMsQ0FBQztJQUM1RCxDQUFDLENBQUM7RUFDTjtFQUVBLFNBQVNDLFdBQVcsQ0FBQ04sU0FBUyxFQUFFO0lBQzVCL0IsTUFBTSxDQUFDTyxPQUFPLENBQUMsQ0FBQ1EsU0FBUyxDQUFDTSxHQUFHLENBQUMsUUFBUSxDQUFDO0lBQ3ZDakIsUUFBUSxDQUFDd0IsS0FBSyxDQUFDVSxhQUFhLEdBQUcsTUFBTTtJQUNyQ3BDLE9BQU8sQ0FBQzBCLEtBQUssQ0FBQ1UsYUFBYSxHQUFHLE1BQU07SUFDcEMsSUFBTUMsY0FBYyxHQUFHUixTQUFTLEtBQUssTUFBTSxHQUFJeEIsT0FBTyxLQUFLLENBQUMsR0FBR1AsTUFBTSxDQUFDZ0MsTUFBTSxHQUFHekIsT0FBTyxHQUFLQSxPQUFPLEtBQUtQLE1BQU0sQ0FBQ2dDLE1BQU0sR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHekIsT0FBTyxHQUFHLENBQUU7SUFDM0llLGtCQUFrQixDQUFDaUIsY0FBYyxDQUFDO0lBQ2xDQyxVQUFVLENBQUMsWUFBTTtNQUNibEMsWUFBWSxDQUFDTSxPQUFPLENBQUMsVUFBQVksS0FBSyxFQUFJO1FBQzFCQSxLQUFLLENBQUNULFNBQVMsQ0FBQ0gsT0FBTyxDQUFDLFVBQUFhLFNBQVMsRUFBSTtVQUNqQyxJQUFJQSxTQUFTLENBQUNDLFVBQVUsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJRCxTQUFTLENBQUNDLFVBQVUsQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUM1RUYsS0FBSyxDQUFDVCxTQUFTLENBQUNFLE1BQU0sQ0FBQ1EsU0FBUyxDQUFDO1VBQ3JDO1FBQ0osQ0FBQyxDQUFDO01BQ04sQ0FBQyxDQUFDO01BQ0ZLLFVBQVUsQ0FBQzlCLE1BQU0sRUFBRStCLFNBQVMsQ0FBQztNQUM3QjNCLFFBQVEsQ0FBQ3dCLEtBQUssQ0FBQ1UsYUFBYSxHQUFHLFNBQVM7TUFDeENwQyxPQUFPLENBQUMwQixLQUFLLENBQUNVLGFBQWEsR0FBRyxTQUFTO0lBQzNDLENBQUMsRUFBRSxJQUFJLENBQUM7RUFDWjtFQUVBcEMsT0FBTyxDQUFDSCxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUU7SUFBQSxPQUFNc0MsV0FBVyxDQUFDLE1BQU0sQ0FBQztFQUFBLEVBQUM7RUFDNURqQyxRQUFRLENBQUNMLGdCQUFnQixDQUFDLE9BQU8sRUFBRTtJQUFBLE9BQU1zQyxXQUFXLENBQUMsT0FBTyxDQUFDO0VBQUEsRUFBQztFQUU5RGhDLFdBQVcsQ0FBQ08sT0FBTyxDQUFDLFVBQUNNLElBQUksRUFBRUosQ0FBQyxFQUFLO0lBQzdCSSxJQUFJLENBQUNuQixnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBTTtNQUNqQ3lDLFVBQVUsQ0FBQyxZQUFNO1FBQ2JuQyxXQUFXLENBQUNPLE9BQU8sQ0FBQyxVQUFBUSxJQUFJO1VBQUEsT0FBSUEsSUFBSSxDQUFDTCxTQUFTLENBQUNFLE1BQU0sQ0FBQyxVQUFVLENBQUM7UUFBQSxFQUFDO01BQ2xFLENBQUMsRUFBRSxJQUFJLENBQUM7TUFFUmpCLE1BQU0sQ0FBQ08sT0FBTyxDQUFDLENBQUNRLFNBQVMsQ0FBQ00sR0FBRyxDQUFDLFFBQVEsQ0FBQztNQUN2Q2QsT0FBTyxHQUFHTyxDQUFDO01BQ1hRLGtCQUFrQixDQUFDZixPQUFPLEdBQUcsQ0FBQyxDQUFDO01BRS9CaUMsVUFBVSxDQUFDLFlBQU07UUFDYk4sY0FBYyxDQUFDN0IsV0FBVyxFQUFFRSxPQUFPLENBQUM7UUFDcENQLE1BQU0sQ0FBQ1ksT0FBTyxDQUFDLFVBQUNDLEtBQUssRUFBRVUsS0FBSyxFQUFLO1VBQzdCVixLQUFLLENBQUNFLFNBQVMsQ0FBQ2tCLE1BQU0sQ0FBQyxTQUFTLEVBQUVWLEtBQUssS0FBS2hCLE9BQU8sQ0FBQztVQUNwRE0sS0FBSyxDQUFDRSxTQUFTLENBQUNFLE1BQU0sQ0FBQyxRQUFRLENBQUM7UUFDcEMsQ0FBQyxDQUFDO1FBQ0ZiLFFBQVEsQ0FBQ3dCLEtBQUssQ0FBQ1UsYUFBYSxHQUFHLFNBQVM7UUFDeENwQyxPQUFPLENBQUMwQixLQUFLLENBQUNVLGFBQWEsR0FBRyxTQUFTO01BQzNDLENBQUMsRUFBRSxJQUFJLENBQUM7SUFDWixDQUFDLENBQUM7RUFDTixDQUFDLENBQUM7RUFFRkosY0FBYyxDQUFDN0IsV0FBVyxFQUFFRSxPQUFPLENBQUM7RUFDcENULFFBQVEsQ0FBQ0MsZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUUsWUFBSztJQUkvQyxJQUFNQyxNQUFNLEdBQUdGLFFBQVEsQ0FBQ0csZ0JBQWdCLENBQUMsUUFBUSxDQUFDO0lBQ2xELElBQU1DLE9BQU8sR0FBR0osUUFBUSxDQUFDSyxhQUFhLENBQUMsbUJBQW1CLENBQUM7SUFDM0QsSUFBTUMsUUFBUSxHQUFHTixRQUFRLENBQUNLLGFBQWEsQ0FBQyxvQkFBb0IsQ0FBQztJQUM3RCxJQUFNRSxXQUFXLEdBQUdQLFFBQVEsQ0FBQ0csZ0JBQWdCLENBQUMscUJBQXFCLENBQUM7SUFFcEUsSUFBSUssWUFBWSxHQUFHLEVBQUU7SUFDckIsSUFBSUMsT0FBTyxHQUFHLENBQUM7SUFDZjtJQUNBLElBQUlDLElBQUksR0FBR0MsWUFBWSxDQUFDQyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUdDLFFBQVEsQ0FBQ0YsWUFBWSxDQUFDQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDO0lBRXBGLElBQUdGLElBQUksS0FBSyxDQUFDLEVBQUM7TUFDVlIsTUFBTSxDQUFDWSxPQUFPLENBQUMsVUFBQ0MsS0FBSyxFQUFFQyxDQUFDLEVBQUk7UUFFeEIsSUFBR0EsQ0FBQyxJQUFJLENBQUMsSUFBSUQsS0FBSyxDQUFDRSxTQUFTLENBQUNDLFFBQVEsZ0JBQVNGLENBQUMsRUFBRyxFQUFDO1VBQy9DRCxLQUFLLENBQUNJLE1BQU0sRUFBRTtRQUNsQjtNQUNKLENBQUMsQ0FBQztNQUNGWixXQUFXLENBQUNPLE9BQU8sQ0FBQyxVQUFDTSxJQUFJLEVBQUVKLENBQUMsRUFBSTtRQUM1QixJQUFHQSxDQUFDLElBQUksQ0FBQyxJQUFJSSxJQUFJLENBQUNILFNBQVMsQ0FBQ0MsUUFBUSxnQkFBU0YsQ0FBQyxFQUFHLEVBQUM7VUFDOUNJLElBQUksQ0FBQ0QsTUFBTSxFQUFFO1FBQ2pCO01BQ0osQ0FBQyxDQUFDO0lBQ047SUFDQSxJQUFHVCxJQUFJLEtBQUssQ0FBQyxFQUFDO01BQ1YsS0FBSyxJQUFJTSxFQUFDLEdBQUcsQ0FBQyxFQUFFQSxFQUFDLElBQUksQ0FBQyxFQUFFQSxFQUFDLEVBQUUsRUFBQztRQUN4QixJQUFJSyxNQUFLLEdBQUdyQixRQUFRLENBQUNHLGdCQUFnQixpQkFBVWEsRUFBQyxFQUFHO1FBQ25ESyxNQUFLLENBQUNQLE9BQU8sQ0FBQyxVQUFBUSxJQUFJLEVBQUk7VUFDbEJBLElBQUksQ0FBQ0gsTUFBTSxFQUFFO1FBQ2pCLENBQUMsQ0FBQztNQUVOO0lBQ0o7SUFFQWpCLE1BQU0sQ0FBQ1ksT0FBTyxDQUFDLFVBQUFDLEtBQUssRUFBSTtNQUNwQlAsWUFBWSxnQ0FBT0EsWUFBWSxzQkFBS08sS0FBSyxDQUFDWixnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFDO0lBQ2pGLENBQUMsQ0FBQztJQUVGRCxNQUFNLENBQUNPLE9BQU8sQ0FBQyxDQUFDUSxTQUFTLENBQUNNLEdBQUcsQ0FBQyxTQUFTLENBQUM7SUFFeEMsU0FBU0Msa0JBQWtCLENBQUNDLEtBQUssRUFBRTtNQUMvQixJQUFHZixJQUFJLEtBQUssQ0FBQyxFQUFDO1FBQ1ZlLEtBQUssSUFBSSxDQUFDO01BQ2Q7TUFDQWpCLFlBQVksQ0FBQ00sT0FBTyxDQUFDLFVBQUFZLEtBQUssRUFBSTtRQUMxQkEsS0FBSyxDQUFDVCxTQUFTLENBQUNILE9BQU8sQ0FBQyxVQUFBYSxTQUFTLEVBQUk7VUFDakMsSUFBSUEsU0FBUyxDQUFDQyxVQUFVLENBQUMsbUJBQW1CLENBQUMsRUFBRTtZQUMzQ0YsS0FBSyxDQUFDVCxTQUFTLENBQUNFLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQztVQUMvQztVQUNBLElBQUlRLFNBQVMsQ0FBQ0MsVUFBVSxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQy9CRixLQUFLLENBQUNULFNBQVMsQ0FBQ0UsTUFBTSxDQUFDUSxTQUFTLENBQUM7VUFDckM7UUFDSixDQUFDLENBQUM7UUFDRixJQUFJRCxLQUFLLENBQUNHLGFBQWEsQ0FBQ0EsYUFBYSxDQUFDWixTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssYUFBYSxFQUFFO1VBQ2xFUyxLQUFLLENBQUNULFNBQVMsQ0FBQ00sR0FBRyxnQkFBU0UsS0FBSyxFQUFHO1VBQ3BDQyxLQUFLLENBQUNJLEtBQUssQ0FBQ0MsVUFBVSxxQ0FBNkJOLEtBQUssdUNBQW1DO1FBQy9GLENBQUMsTUFBTTtVQUNIQyxLQUFLLENBQUNULFNBQVMsQ0FBQ00sR0FBRyxDQUFDLG1CQUFtQixDQUFDO1FBQzVDO01BQ0osQ0FBQyxDQUFDO0lBQ047SUFFQSxTQUFTUyxVQUFVLENBQUM5QixNQUFNLEVBQUUrQixTQUFTLEVBQUU7TUFDbkMsSUFBSUEsU0FBUyxLQUFLLE1BQU0sRUFBRTtRQUN0QixFQUFFeEIsT0FBTztRQUNULElBQUlBLE9BQU8sR0FBRyxDQUFDLEVBQUVBLE9BQU8sR0FBR1AsTUFBTSxDQUFDZ0MsTUFBTSxHQUFHLENBQUM7TUFDaEQsQ0FBQyxNQUFNLElBQUlELFNBQVMsS0FBSyxPQUFPLEVBQUU7UUFDOUIsRUFBRXhCLE9BQU87UUFDVCxJQUFJQSxPQUFPLEdBQUdQLE1BQU0sQ0FBQ2dDLE1BQU0sR0FBRyxDQUFDLEVBQUV6QixPQUFPLEdBQUcsQ0FBQztNQUNoRDtNQUVBUCxNQUFNLENBQUNZLE9BQU8sQ0FBQyxVQUFDQyxLQUFLLEVBQUVDLENBQUMsRUFBSztRQUN6QkQsS0FBSyxDQUFDRSxTQUFTLENBQUNrQixNQUFNLENBQUMsU0FBUyxFQUFFbkIsQ0FBQyxLQUFLUCxPQUFPLENBQUM7UUFDaERNLEtBQUssQ0FBQ0UsU0FBUyxDQUFDRSxNQUFNLENBQUMsUUFBUSxDQUFDO01BQ3BDLENBQUMsQ0FBQztNQUVGaUIsY0FBYyxDQUFDN0IsV0FBVyxFQUFFRSxPQUFPLENBQUM7SUFDeEM7SUFFQSxTQUFTMkIsY0FBYyxDQUFDQyxLQUFLLEVBQUU1QixPQUFPLEVBQUU7TUFDcEM0QixLQUFLLENBQUN2QixPQUFPLENBQUMsVUFBQ00sSUFBSSxFQUFFa0IsU0FBUyxFQUFLO1FBQy9CbEIsSUFBSSxDQUFDSCxTQUFTLENBQUNrQixNQUFNLENBQUMsVUFBVSxFQUFFMUIsT0FBTyxLQUFLNkIsU0FBUyxDQUFDO01BQzVELENBQUMsQ0FBQztJQUNOO0lBRUEsU0FBU0MsV0FBVyxDQUFDTixTQUFTLEVBQUU7TUFDNUIvQixNQUFNLENBQUNPLE9BQU8sQ0FBQyxDQUFDUSxTQUFTLENBQUNNLEdBQUcsQ0FBQyxRQUFRLENBQUM7TUFDdkNqQixRQUFRLENBQUN3QixLQUFLLENBQUNVLGFBQWEsR0FBRyxNQUFNO01BQ3JDcEMsT0FBTyxDQUFDMEIsS0FBSyxDQUFDVSxhQUFhLEdBQUcsTUFBTTtNQUNwQyxJQUFNQyxjQUFjLEdBQUdSLFNBQVMsS0FBSyxNQUFNLEdBQUl4QixPQUFPLEtBQUssQ0FBQyxHQUFHUCxNQUFNLENBQUNnQyxNQUFNLEdBQUd6QixPQUFPLEdBQUtBLE9BQU8sS0FBS1AsTUFBTSxDQUFDZ0MsTUFBTSxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUd6QixPQUFPLEdBQUcsQ0FBRTtNQUMzSWUsa0JBQWtCLENBQUNpQixjQUFjLENBQUM7TUFDbENDLFVBQVUsQ0FBQyxZQUFNO1FBQ2JsQyxZQUFZLENBQUNNLE9BQU8sQ0FBQyxVQUFBWSxLQUFLLEVBQUk7VUFDMUJBLEtBQUssQ0FBQ1QsU0FBUyxDQUFDSCxPQUFPLENBQUMsVUFBQWEsU0FBUyxFQUFJO1lBQ2pDLElBQUlBLFNBQVMsQ0FBQ0MsVUFBVSxDQUFDLG1CQUFtQixDQUFDLElBQUlELFNBQVMsQ0FBQ0MsVUFBVSxDQUFDLE9BQU8sQ0FBQyxFQUFFO2NBQzVFRixLQUFLLENBQUNULFNBQVMsQ0FBQ0UsTUFBTSxDQUFDUSxTQUFTLENBQUM7WUFDckM7VUFDSixDQUFDLENBQUM7UUFDTixDQUFDLENBQUM7UUFDRkssVUFBVSxDQUFDOUIsTUFBTSxFQUFFK0IsU0FBUyxDQUFDO1FBQzdCM0IsUUFBUSxDQUFDd0IsS0FBSyxDQUFDVSxhQUFhLEdBQUcsU0FBUztRQUN4Q3BDLE9BQU8sQ0FBQzBCLEtBQUssQ0FBQ1UsYUFBYSxHQUFHLFNBQVM7TUFDM0MsQ0FBQyxFQUFFLElBQUksQ0FBQztJQUNaO0lBRUFwQyxPQUFPLENBQUNILGdCQUFnQixDQUFDLE9BQU8sRUFBRTtNQUFBLE9BQU1zQyxXQUFXLENBQUMsTUFBTSxDQUFDO0lBQUEsRUFBQztJQUM1RGpDLFFBQVEsQ0FBQ0wsZ0JBQWdCLENBQUMsT0FBTyxFQUFFO01BQUEsT0FBTXNDLFdBQVcsQ0FBQyxPQUFPLENBQUM7SUFBQSxFQUFDO0lBRTlEaEMsV0FBVyxDQUFDTyxPQUFPLENBQUMsVUFBQ00sSUFBSSxFQUFFSixDQUFDLEVBQUs7TUFDN0JJLElBQUksQ0FBQ25CLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxZQUFNO1FBQ2pDeUMsVUFBVSxDQUFDLFlBQU07VUFDYm5DLFdBQVcsQ0FBQ08sT0FBTyxDQUFDLFVBQUFRLElBQUk7WUFBQSxPQUFJQSxJQUFJLENBQUNMLFNBQVMsQ0FBQ0UsTUFBTSxDQUFDLFVBQVUsQ0FBQztVQUFBLEVBQUM7UUFDbEUsQ0FBQyxFQUFFLElBQUksQ0FBQztRQUVSakIsTUFBTSxDQUFDTyxPQUFPLENBQUMsQ0FBQ1EsU0FBUyxDQUFDTSxHQUFHLENBQUMsUUFBUSxDQUFDO1FBQ3ZDZCxPQUFPLEdBQUdPLENBQUM7UUFDWFEsa0JBQWtCLENBQUNmLE9BQU8sR0FBRyxDQUFDLENBQUM7UUFFL0JpQyxVQUFVLENBQUMsWUFBTTtVQUNiTixjQUFjLENBQUM3QixXQUFXLEVBQUVFLE9BQU8sQ0FBQztVQUNwQ1AsTUFBTSxDQUFDWSxPQUFPLENBQUMsVUFBQ0MsS0FBSyxFQUFFVSxLQUFLLEVBQUs7WUFDN0JWLEtBQUssQ0FBQ0UsU0FBUyxDQUFDa0IsTUFBTSxDQUFDLFNBQVMsRUFBRVYsS0FBSyxLQUFLaEIsT0FBTyxDQUFDO1lBQ3BETSxLQUFLLENBQUNFLFNBQVMsQ0FBQ0UsTUFBTSxDQUFDLFFBQVEsQ0FBQztVQUNwQyxDQUFDLENBQUM7VUFDRmIsUUFBUSxDQUFDd0IsS0FBSyxDQUFDVSxhQUFhLEdBQUcsU0FBUztVQUN4Q3BDLE9BQU8sQ0FBQzBCLEtBQUssQ0FBQ1UsYUFBYSxHQUFHLFNBQVM7UUFDM0MsQ0FBQyxFQUFFLElBQUksQ0FBQztNQUNaLENBQUMsQ0FBQztJQUNOLENBQUMsQ0FBQztJQUVGSixjQUFjLENBQUM3QixXQUFXLEVBQUVFLE9BQU8sQ0FBQzs7SUFFNUM7O0lBRVEsSUFBTVksS0FBSyxHQUFHckIsUUFBUSxDQUFDSyxhQUFhLENBQUMsUUFBUSxDQUFDO0lBQzlDLElBQU1zQyxLQUFLLEdBQUczQyxRQUFRLENBQUNLLGFBQWEsQ0FBQyxRQUFRLENBQUM7SUFFOUNnQixLQUFLLENBQUNwQixnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBTTtNQUNsQ1UsWUFBWSxDQUFDaUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7TUFDL0JDLFFBQVEsQ0FBQ0MsTUFBTSxFQUFFO0lBQ3JCLENBQUMsQ0FBQztJQUVGSCxLQUFLLENBQUMxQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBTTtNQUNsQ1UsWUFBWSxDQUFDaUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7TUFDL0JDLFFBQVEsQ0FBQ0MsTUFBTSxFQUFFO0lBQ3JCLENBQUMsQ0FBQztFQUdOLENBQUMsQ0FBQztFQUVGLFNBQVNDLGFBQWEsR0FBRTtJQUNwQixLQUFLLElBQUkvQixHQUFDLEdBQUcsQ0FBQyxFQUFFQSxHQUFDLElBQUksRUFBRSxFQUFFQSxHQUFDLEVBQUUsRUFBRTtNQUMxQixJQUFNZ0MsSUFBSSxHQUFHLElBQUlDLEtBQUssRUFBRTtNQUN4QixJQUFNQyxPQUFPLEdBQUcsSUFBSUQsS0FBSyxFQUFFO01BQzNCLElBQU1FLE9BQU8sR0FBRyxJQUFJRixLQUFLLEVBQUU7TUFDM0IsSUFBTUcsVUFBVSxHQUFHLElBQUlILEtBQUssRUFBRTtNQUM5QkQsSUFBSSxDQUFDSyxHQUFHLCtCQUF3QnJDLEdBQUMsY0FBVztNQUM1Q2tDLE9BQU8sQ0FBQ0csR0FBRywrQkFBd0JyQyxHQUFDLGtCQUFlO01BQ25EbUMsT0FBTyxDQUFDRSxHQUFHLCtCQUF3QnJDLEdBQUMsa0JBQWU7TUFDbkRvQyxVQUFVLENBQUNDLEdBQUcsK0JBQXdCckMsR0FBQyxzQkFBbUI7SUFDOUQ7RUFDSjtFQUVBK0IsYUFBYSxFQUFFOztFQUVuQjs7RUFFSSxJQUFNMUIsS0FBSyxHQUFHckIsUUFBUSxDQUFDSyxhQUFhLENBQUMsUUFBUSxDQUFDO0VBQzlDLElBQU1zQyxLQUFLLEdBQUczQyxRQUFRLENBQUNLLGFBQWEsQ0FBQyxRQUFRLENBQUM7RUFFOUNnQixLQUFLLENBQUNwQixnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBTTtJQUNsQ1UsWUFBWSxDQUFDaUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDL0JDLFFBQVEsQ0FBQ0MsTUFBTSxFQUFFO0VBQ3JCLENBQUMsQ0FBQztFQUVGSCxLQUFLLENBQUMxQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBTTtJQUNsQ1UsWUFBWSxDQUFDaUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDL0JDLFFBQVEsQ0FBQ0MsTUFBTSxFQUFFO0VBQ3JCLENBQUMsQ0FBQztBQUdOLENBQUMsQ0FBQyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT57XG5cblxuXG4gICAgY29uc3Qgc2xpZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zbGlkZVwiKTtcbiAgICBjb25zdCBsZWZ0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zbGlkZV9fbW92ZS1sZWZ0XCIpO1xuICAgIGNvbnN0IHJpZ2h0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zbGlkZV9fbW92ZS1yaWdodFwiKTtcbiAgICBjb25zdCBzbGlkZXNJY29ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucXVlc3RzX19pY29ucy1pdGVtXCIpO1xuXG4gICAgbGV0IGdsaXRjaExheWVycyA9IFtdO1xuICAgIGxldCBjdXJyZW50ID0gMTtcbiAgICAvLyBsZXQgd2VlayA9IDI7XG4gICAgbGV0IHdlZWsgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcIndlZWtcIikgPyBwYXJzZUludChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcIndlZWtcIikpIDogMTtcblxuICAgIGlmKHdlZWsgPT09IDEpe1xuICAgICAgICBzbGlkZXMuZm9yRWFjaCgoc2xpZGUsIGkpID0+e1xuXG4gICAgICAgICAgICBpZihpID49IDYgfHwgc2xpZGUuY2xhc3NMaXN0LmNvbnRhaW5zKGBxdWVzdCR7aX1gKSl7XG4gICAgICAgICAgICAgICAgc2xpZGUucmVtb3ZlKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgc2xpZGVzSWNvbnMuZm9yRWFjaCgoaWNvbiwgaSkgPT57XG4gICAgICAgICAgICBpZihpID49IDYgfHwgaWNvbi5jbGFzc0xpc3QuY29udGFpbnMoYHF1ZXN0JHtpfWApKXtcbiAgICAgICAgICAgICAgICBpY29uLnJlbW92ZSgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfVxuICAgIGlmKHdlZWsgPT09IDIpe1xuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSA2OyBpKyspe1xuICAgICAgICAgICAgbGV0IHdlZWsxID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLnF1ZXN0JHtpfWApXG4gICAgICAgICAgICB3ZWVrMS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgICAgICAgIGl0ZW0ucmVtb3ZlKClcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNsaWRlcy5mb3JFYWNoKHNsaWRlID0+IHtcbiAgICAgICAgZ2xpdGNoTGF5ZXJzID0gWy4uLmdsaXRjaExheWVycywgLi4uc2xpZGUucXVlcnlTZWxlY3RvckFsbChcIi5nbGl0Y2hfX2xheWVyXCIpXTtcbiAgICB9KTtcblxuICAgIHNsaWRlc1tjdXJyZW50XS5jbGFzc0xpc3QuYWRkKFwiX2FjdGl2ZVwiKTtcblxuICAgIGZ1bmN0aW9uIHVwZGF0ZUdsaXRjaExheWVycyhpbmRleCkge1xuICAgICAgICBpZih3ZWVrID09PSAyKXtcbiAgICAgICAgICAgIGluZGV4ICs9IDZcbiAgICAgICAgfVxuICAgICAgICBnbGl0Y2hMYXllcnMuZm9yRWFjaChsYXllciA9PiB7XG4gICAgICAgICAgICBsYXllci5jbGFzc0xpc3QuZm9yRWFjaChjbGFzc05hbWUgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjbGFzc05hbWUuc3RhcnRzV2l0aChcInNsaWRlLWluZm8tZ2xpdGNoXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5yZW1vdmUoXCJzbGlkZS1pbmZvLWdsaXRjaFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNsYXNzTmFtZS5zdGFydHNXaXRoKFwicXVlc3RcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgbGF5ZXIuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGxheWVyLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5jbGFzc0xpc3RbMF0gIT09IFwic2xpZGVfX2luZm9cIikge1xuICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5hZGQoYHF1ZXN0JHtpbmRleH1gKTtcbiAgICAgICAgICAgICAgICBsYXllci5zdHlsZS5iYWNrZ3JvdW5kID0gYHVybChcIi4vaW1nL3F1ZXN0cy9zbGlkZSR7aW5kZXh9L3BlcnMucG5nXCIpIG5vLXJlcGVhdCAwIDAvY29udGFpbmA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5hZGQoXCJzbGlkZS1pbmZvLWdsaXRjaFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbW92ZVNsaWRlcihzbGlkZXMsIGRpcmVjdGlvbikge1xuICAgICAgICBpZiAoZGlyZWN0aW9uID09PSBcImxlZnRcIikge1xuICAgICAgICAgICAgLS1jdXJyZW50O1xuICAgICAgICAgICAgaWYgKGN1cnJlbnQgPCAwKSBjdXJyZW50ID0gc2xpZGVzLmxlbmd0aCAtIDE7XG4gICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSBcInJpZ2h0XCIpIHtcbiAgICAgICAgICAgICsrY3VycmVudDtcbiAgICAgICAgICAgIGlmIChjdXJyZW50ID4gc2xpZGVzLmxlbmd0aCAtIDEpIGN1cnJlbnQgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgc2xpZGVzLmZvckVhY2goKHNsaWRlLCBpKSA9PiB7XG4gICAgICAgICAgICBzbGlkZS5jbGFzc0xpc3QudG9nZ2xlKFwiX2FjdGl2ZVwiLCBpID09PSBjdXJyZW50KTtcbiAgICAgICAgICAgIHNsaWRlLmNsYXNzTGlzdC5yZW1vdmUoXCJnbGl0Y2hcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIFNsaWRlSWNvbnNJbml0KHNsaWRlc0ljb25zLCBjdXJyZW50KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBTbGlkZUljb25zSW5pdChpY29ucywgY3VycmVudCkge1xuICAgICAgICBpY29ucy5mb3JFYWNoKChpY29uLCBpY29uSW5kZXgpID0+IHtcbiAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LnRvZ2dsZShcIl9jdXJyZW50XCIsIGN1cnJlbnQgPT09IGljb25JbmRleCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGhhbmRsZUNsaWNrKGRpcmVjdGlvbikge1xuICAgICAgICBzbGlkZXNbY3VycmVudF0uY2xhc3NMaXN0LmFkZChcImdsaXRjaFwiKTtcbiAgICAgICAgcmlnaHRCdG4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiO1xuICAgICAgICBsZWZ0QnRuLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIjtcbiAgICAgICAgY29uc3QgbmV4dFNsaWRlSW5kZXggPSBkaXJlY3Rpb24gPT09IFwibGVmdFwiID8gKGN1cnJlbnQgPT09IDAgPyBzbGlkZXMubGVuZ3RoIDogY3VycmVudCkgOiAoY3VycmVudCA9PT0gc2xpZGVzLmxlbmd0aCAtIDEgPyAxIDogY3VycmVudCArIDIpO1xuICAgICAgICB1cGRhdGVHbGl0Y2hMYXllcnMobmV4dFNsaWRlSW5kZXgpO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGdsaXRjaExheWVycy5mb3JFYWNoKGxheWVyID0+IHtcbiAgICAgICAgICAgICAgICBsYXllci5jbGFzc0xpc3QuZm9yRWFjaChjbGFzc05hbWUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2xhc3NOYW1lLnN0YXJ0c1dpdGgoXCJzbGlkZS1pbmZvLWdsaXRjaFwiKSB8fCBjbGFzc05hbWUuc3RhcnRzV2l0aChcInF1ZXN0XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXllci5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbW92ZVNsaWRlcihzbGlkZXMsIGRpcmVjdGlvbik7XG4gICAgICAgICAgICByaWdodEJ0bi5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJpbml0aWFsXCI7XG4gICAgICAgICAgICBsZWZ0QnRuLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcImluaXRpYWxcIjtcbiAgICAgICAgfSwgMTAwMCk7XG4gICAgfVxuXG4gICAgbGVmdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gaGFuZGxlQ2xpY2soXCJsZWZ0XCIpKTtcbiAgICByaWdodEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gaGFuZGxlQ2xpY2soXCJyaWdodFwiKSk7XG5cbiAgICBzbGlkZXNJY29ucy5mb3JFYWNoKChpY29uLCBpKSA9PiB7XG4gICAgICAgIGljb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNsaWRlc0ljb25zLmZvckVhY2goaXRlbSA9PiBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoXCJfY3VycmVudFwiKSk7XG4gICAgICAgICAgICB9LCAxMDAwKTtcblxuICAgICAgICAgICAgc2xpZGVzW2N1cnJlbnRdLmNsYXNzTGlzdC5hZGQoXCJnbGl0Y2hcIik7XG4gICAgICAgICAgICBjdXJyZW50ID0gaTtcbiAgICAgICAgICAgIHVwZGF0ZUdsaXRjaExheWVycyhjdXJyZW50ICsgMSk7XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIFNsaWRlSWNvbnNJbml0KHNsaWRlc0ljb25zLCBjdXJyZW50KTtcbiAgICAgICAgICAgICAgICBzbGlkZXMuZm9yRWFjaCgoc2xpZGUsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHNsaWRlLmNsYXNzTGlzdC50b2dnbGUoXCJfYWN0aXZlXCIsIGluZGV4ID09PSBjdXJyZW50KTtcbiAgICAgICAgICAgICAgICAgICAgc2xpZGUuY2xhc3NMaXN0LnJlbW92ZShcImdsaXRjaFwiKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByaWdodEJ0bi5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJpbml0aWFsXCI7XG4gICAgICAgICAgICAgICAgbGVmdEJ0bi5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJpbml0aWFsXCI7XG4gICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBTbGlkZUljb25zSW5pdChzbGlkZXNJY29ucywgY3VycmVudCk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT57XG5cblxuXG4gICAgICAgIGNvbnN0IHNsaWRlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc2xpZGVcIik7XG4gICAgICAgIGNvbnN0IGxlZnRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNsaWRlX19tb3ZlLWxlZnRcIik7XG4gICAgICAgIGNvbnN0IHJpZ2h0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zbGlkZV9fbW92ZS1yaWdodFwiKTtcbiAgICAgICAgY29uc3Qgc2xpZGVzSWNvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnF1ZXN0c19faWNvbnMtaXRlbVwiKTtcblxuICAgICAgICBsZXQgZ2xpdGNoTGF5ZXJzID0gW107XG4gICAgICAgIGxldCBjdXJyZW50ID0gMTtcbiAgICAgICAgLy8gbGV0IHdlZWsgPSAyO1xuICAgICAgICBsZXQgd2VlayA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwid2Vla1wiKSA/IHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwid2Vla1wiKSkgOiAxO1xuXG4gICAgICAgIGlmKHdlZWsgPT09IDEpe1xuICAgICAgICAgICAgc2xpZGVzLmZvckVhY2goKHNsaWRlLCBpKSA9PntcblxuICAgICAgICAgICAgICAgIGlmKGkgPj0gNiB8fCBzbGlkZS5jbGFzc0xpc3QuY29udGFpbnMoYHF1ZXN0JHtpfWApKXtcbiAgICAgICAgICAgICAgICAgICAgc2xpZGUucmVtb3ZlKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgc2xpZGVzSWNvbnMuZm9yRWFjaCgoaWNvbiwgaSkgPT57XG4gICAgICAgICAgICAgICAgaWYoaSA+PSA2IHx8IGljb24uY2xhc3NMaXN0LmNvbnRhaW5zKGBxdWVzdCR7aX1gKSl7XG4gICAgICAgICAgICAgICAgICAgIGljb24ucmVtb3ZlKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIGlmKHdlZWsgPT09IDIpe1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gNjsgaSsrKXtcbiAgICAgICAgICAgICAgICBsZXQgd2VlazEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAucXVlc3Qke2l9YClcbiAgICAgICAgICAgICAgICB3ZWVrMS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgICAgICAgICAgICBpdGVtLnJlbW92ZSgpXG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgc2xpZGVzLmZvckVhY2goc2xpZGUgPT4ge1xuICAgICAgICAgICAgZ2xpdGNoTGF5ZXJzID0gWy4uLmdsaXRjaExheWVycywgLi4uc2xpZGUucXVlcnlTZWxlY3RvckFsbChcIi5nbGl0Y2hfX2xheWVyXCIpXTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc2xpZGVzW2N1cnJlbnRdLmNsYXNzTGlzdC5hZGQoXCJfYWN0aXZlXCIpO1xuXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUdsaXRjaExheWVycyhpbmRleCkge1xuICAgICAgICAgICAgaWYod2VlayA9PT0gMil7XG4gICAgICAgICAgICAgICAgaW5kZXggKz0gNlxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZ2xpdGNoTGF5ZXJzLmZvckVhY2gobGF5ZXIgPT4ge1xuICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5mb3JFYWNoKGNsYXNzTmFtZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjbGFzc05hbWUuc3RhcnRzV2l0aChcInNsaWRlLWluZm8tZ2xpdGNoXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXllci5jbGFzc0xpc3QucmVtb3ZlKFwic2xpZGUtaW5mby1nbGl0Y2hcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNsYXNzTmFtZS5zdGFydHNXaXRoKFwicXVlc3RcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChsYXllci5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0WzBdICE9PSBcInNsaWRlX19pbmZvXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGF5ZXIuY2xhc3NMaXN0LmFkZChgcXVlc3Qke2luZGV4fWApO1xuICAgICAgICAgICAgICAgICAgICBsYXllci5zdHlsZS5iYWNrZ3JvdW5kID0gYHVybChcIi4vaW1nL3F1ZXN0cy9zbGlkZSR7aW5kZXh9L3BlcnMucG5nXCIpIG5vLXJlcGVhdCAwIDAvY29udGFpbmA7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbGF5ZXIuY2xhc3NMaXN0LmFkZChcInNsaWRlLWluZm8tZ2xpdGNoXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbW92ZVNsaWRlcihzbGlkZXMsIGRpcmVjdGlvbikge1xuICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gXCJsZWZ0XCIpIHtcbiAgICAgICAgICAgICAgICAtLWN1cnJlbnQ7XG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnQgPCAwKSBjdXJyZW50ID0gc2xpZGVzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gXCJyaWdodFwiKSB7XG4gICAgICAgICAgICAgICAgKytjdXJyZW50O1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50ID4gc2xpZGVzLmxlbmd0aCAtIDEpIGN1cnJlbnQgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzbGlkZXMuZm9yRWFjaCgoc2xpZGUsIGkpID0+IHtcbiAgICAgICAgICAgICAgICBzbGlkZS5jbGFzc0xpc3QudG9nZ2xlKFwiX2FjdGl2ZVwiLCBpID09PSBjdXJyZW50KTtcbiAgICAgICAgICAgICAgICBzbGlkZS5jbGFzc0xpc3QucmVtb3ZlKFwiZ2xpdGNoXCIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIFNsaWRlSWNvbnNJbml0KHNsaWRlc0ljb25zLCBjdXJyZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIFNsaWRlSWNvbnNJbml0KGljb25zLCBjdXJyZW50KSB7XG4gICAgICAgICAgICBpY29ucy5mb3JFYWNoKChpY29uLCBpY29uSW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBpY29uLmNsYXNzTGlzdC50b2dnbGUoXCJfY3VycmVudFwiLCBjdXJyZW50ID09PSBpY29uSW5kZXgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBoYW5kbGVDbGljayhkaXJlY3Rpb24pIHtcbiAgICAgICAgICAgIHNsaWRlc1tjdXJyZW50XS5jbGFzc0xpc3QuYWRkKFwiZ2xpdGNoXCIpO1xuICAgICAgICAgICAgcmlnaHRCdG4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiO1xuICAgICAgICAgICAgbGVmdEJ0bi5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7XG4gICAgICAgICAgICBjb25zdCBuZXh0U2xpZGVJbmRleCA9IGRpcmVjdGlvbiA9PT0gXCJsZWZ0XCIgPyAoY3VycmVudCA9PT0gMCA/IHNsaWRlcy5sZW5ndGggOiBjdXJyZW50KSA6IChjdXJyZW50ID09PSBzbGlkZXMubGVuZ3RoIC0gMSA/IDEgOiBjdXJyZW50ICsgMik7XG4gICAgICAgICAgICB1cGRhdGVHbGl0Y2hMYXllcnMobmV4dFNsaWRlSW5kZXgpO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgZ2xpdGNoTGF5ZXJzLmZvckVhY2gobGF5ZXIgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsYXllci5jbGFzc0xpc3QuZm9yRWFjaChjbGFzc05hbWUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNsYXNzTmFtZS5zdGFydHNXaXRoKFwic2xpZGUtaW5mby1nbGl0Y2hcIikgfHwgY2xhc3NOYW1lLnN0YXJ0c1dpdGgoXCJxdWVzdFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgbW92ZVNsaWRlcihzbGlkZXMsIGRpcmVjdGlvbik7XG4gICAgICAgICAgICAgICAgcmlnaHRCdG4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiaW5pdGlhbFwiO1xuICAgICAgICAgICAgICAgIGxlZnRCdG4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiaW5pdGlhbFwiO1xuICAgICAgICAgICAgfSwgMTAwMCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZWZ0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBoYW5kbGVDbGljayhcImxlZnRcIikpO1xuICAgICAgICByaWdodEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gaGFuZGxlQ2xpY2soXCJyaWdodFwiKSk7XG5cbiAgICAgICAgc2xpZGVzSWNvbnMuZm9yRWFjaCgoaWNvbiwgaSkgPT4ge1xuICAgICAgICAgICAgaWNvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzbGlkZXNJY29ucy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5jbGFzc0xpc3QucmVtb3ZlKFwiX2N1cnJlbnRcIikpO1xuICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuXG4gICAgICAgICAgICAgICAgc2xpZGVzW2N1cnJlbnRdLmNsYXNzTGlzdC5hZGQoXCJnbGl0Y2hcIik7XG4gICAgICAgICAgICAgICAgY3VycmVudCA9IGk7XG4gICAgICAgICAgICAgICAgdXBkYXRlR2xpdGNoTGF5ZXJzKGN1cnJlbnQgKyAxKTtcblxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBTbGlkZUljb25zSW5pdChzbGlkZXNJY29ucywgY3VycmVudCk7XG4gICAgICAgICAgICAgICAgICAgIHNsaWRlcy5mb3JFYWNoKChzbGlkZSwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlLmNsYXNzTGlzdC50b2dnbGUoXCJfYWN0aXZlXCIsIGluZGV4ID09PSBjdXJyZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlLmNsYXNzTGlzdC5yZW1vdmUoXCJnbGl0Y2hcIik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByaWdodEJ0bi5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJpbml0aWFsXCI7XG4gICAgICAgICAgICAgICAgICAgIGxlZnRCdG4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiaW5pdGlhbFwiO1xuICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIFNsaWRlSWNvbnNJbml0KHNsaWRlc0ljb25zLCBjdXJyZW50KTtcblxuLy8gZm9yIHRlc3RcblxuICAgICAgICBjb25zdCB3ZWVrMSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIud2VlazFcIik7XG4gICAgICAgIGNvbnN0IHdlZWsyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53ZWVrMlwiKTtcblxuICAgICAgICB3ZWVrMS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJ3ZWVrXCIsIDEpO1xuICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHdlZWsyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcIndlZWtcIiwgMik7XG4gICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgfSk7XG5cblxuICAgIH0pXG5cbiAgICBmdW5jdGlvbiBwcmVsb2FkSW1hZ2VzKCl7XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IDEyOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHBlcnMgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICAgIGNvbnN0IHBlcnNNb2IgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICAgIGNvbnN0IHNsaWRlQmcgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICAgIGNvbnN0IHNsaWRlQmdNb2IgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICAgIHBlcnMuc3JjID0gYC4vaW1nL3F1ZXN0cy9zbGlkZSR7aX0vcGVycy5wbmdgO1xuICAgICAgICAgICAgcGVyc01vYi5zcmMgPSBgLi9pbWcvcXVlc3RzL3NsaWRlJHtpfS9wZXJzLW1vYi5wbmdgO1xuICAgICAgICAgICAgc2xpZGVCZy5zcmMgPSBgLi9pbWcvcXVlc3RzL3NsaWRlJHtpfS9zbGlkZS1iZy5wbmdgO1xuICAgICAgICAgICAgc2xpZGVCZ01vYi5zcmMgPSBgLi9pbWcvcXVlc3RzL3NsaWRlJHtpfS9zbGlkZS1iZy1tb2IucG5nYDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByZWxvYWRJbWFnZXMoKVxuXG4vLyBmb3IgdGVzdFxuXG4gICAgY29uc3Qgd2VlazEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLndlZWsxXCIpO1xuICAgIGNvbnN0IHdlZWsyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53ZWVrMlwiKTtcblxuICAgIHdlZWsxLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwid2Vla1wiLCAxKTtcbiAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgfSk7XG5cbiAgICB3ZWVrMi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcIndlZWtcIiwgMik7XG4gICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgIH0pO1xuXG5cbn0pXG5cbiJdfQ==
