"use strict";

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
document.addEventListener("DOMContentLoaded", function () {
  // let week = 2;
  //
  // if(week === 1){
  //     slides.forEach((slide, i) =>{
  //
  //         if(i >= 6 || slide.classList.contains(`quest${i}`)){
  //             slide.remove()
  //         }
  //     })
  //     slidesIcons.forEach((icon, i) =>{
  //         if(i >= 6 || icon.classList.contains(`quest${i}`)){
  //             icon.remove()
  //         }
  //     })
  // }
  // if(week === 2){
  //     for (let i = 1; i <= 6; i++){
  //         let week1 = document.querySelectorAll(`.quest${i}`)
  //         week1.forEach(item => {
  //             item.remove()
  //         })
  //
  //     }
  // }

  var slides = document.querySelectorAll(".slide");
  var leftBtn = document.querySelector(".slide__move-left");
  var rightBtn = document.querySelector(".slide__move-right");
  var slidesIcons = document.querySelectorAll(".quests__icons-item");
  var glitchLayers = [];
  slides.forEach(function (slide) {
    glitchLayers = [].concat(_toConsumableArray(glitchLayers), _toConsumableArray(slide.querySelectorAll(".glitch__layer")));
  });
  var current = 1;
  slides.forEach(function (slide, i) {
    if (i === current) {
      slide.classList.add("_active");
    }
  });
  function moveSlider(slides, direction) {
    if (direction === "left") {
      --current;
      slides.forEach(function (slide, i) {
        slide.classList.remove("_active", "glitch");
        if (current < 0) current = slides.length - 1;
        if (i === current) {
          slide.classList.add("_active");
          slide.classList.remove("glitch");
        }
      });
    }
    if (direction === "right") {
      ++current;
      slides.forEach(function (slide, i) {
        slide.classList.remove("_active", "glitch");
        if (current > slides.length - 1) current = 0;
        if (i === current) {
          slide.classList.add("_active");
          slide.classList.remove("glitch");
        }
      });
    }
    SlideIconsInit(slidesIcons, current);
  }
  leftBtn.addEventListener("click", function () {
    slides[current].classList.add("glitch");
    if (current === 0) {
      glitchLayers.forEach(function (layer) {
        if (layer.parentElement.parentElement.classList[0] !== "slide__info") {
          layer.classList.add("quest".concat(slides.length));
          layer.style.background = "url(\"../img/quests/slide".concat(slides.length, "/pers.png\") no-repeat 0 0/contain");
        } else {
          layer.classList.add("slide-info-glitch");
        }
      });
    } else {
      glitchLayers.forEach(function (layer) {
        if (layer.parentElement.parentElement.classList[0] !== "slide__info") {
          layer.classList.add("quest".concat(current));
          layer.style.background = "url(\"../img/quests/slide".concat(current, "/pers.png\") no-repeat 0 0/contain");
        } else {
          layer.classList.add("slide-info-glitch");
        }
      });
    }
    rightBtn.style.pointerEvents = "none";
    leftBtn.style.pointerEvents = "none";
    setTimeout(function () {
      glitchLayers.forEach(function (layer) {
        layer.classList.forEach(function (className) {
          if (className.startsWith("slide-info-glitch")) {
            layer.classList.remove("slide-info-glitch");
          }
          if (className.startsWith("quest")) {
            layer.classList.remove(className);
          }
        });
      });
      moveSlider(slides, "left");
      rightBtn.style.pointerEvents = "initial";
      leftBtn.style.pointerEvents = "initial";
    }, 1000);
  });
  rightBtn.addEventListener("click", function () {
    slides[current].classList.add("glitch");
    rightBtn.style.pointerEvents = "none";
    leftBtn.style.pointerEvents = "none";
    if (current === slides.length - 1) {
      glitchLayers.forEach(function (layer) {
        if (layer.parentElement.parentElement.classList[0] !== "slide__info") {
          layer.classList.add("quest1");
          layer.style.background = "url(\"../img/quests/slide1/pers.png\") no-repeat 0 0/contain";
        } else {
          layer.classList.add("slide-info-glitch");
        }
      });
    } else {
      current += 2;
      glitchLayers.forEach(function (layer) {
        if (layer.parentElement.parentElement.classList[0] !== "slide__info") {
          layer.classList.add("quest".concat(current));
          layer.style.background = "url(\"../img/quests/slide".concat(current, "/pers.png\") no-repeat 0 0/contain");
        } else {
          layer.classList.add("slide-info-glitch");
        }
      });
      current -= 2;
    }
    setTimeout(function () {
      glitchLayers.forEach(function (layer) {
        layer.classList.forEach(function (className) {
          if (className.startsWith("slide-info-glitch")) {
            layer.classList.remove("slide-info-glitch");
          }
          if (className.startsWith("quest")) {
            layer.classList.remove(className);
          }
        });
      });
      moveSlider(slides, "right");
      rightBtn.style.pointerEvents = "initial";
      leftBtn.style.pointerEvents = "initial";
    }, 1000);
  });
  function SlideIconsInit(icons, current) {
    // slides.forEach((slide, slideIndex) => {
    //     icons.forEach((icon, iconIndex) =>{
    //         if (current ==)
    //     })
    // })
    icons.forEach(function (icon, iconIndex) {
      icon.classList.remove("_current");
      if (current === iconIndex) {
        icon.classList.add("_current");
      }
    });
  }
  slidesIcons.forEach(function (icon, i) {
    icon.addEventListener("click", function (e) {
      setTimeout(function () {
        slidesIcons.forEach(function (item) {
          item.classList.remove("_current");
        });
      }, 1000);
      slides[current].classList.add("glitch");
      current = i;
      if (i === current) {
        slides.forEach(function (slide, i) {
          if (i === current) {
            rightBtn.style.pointerEvents = "none";
            leftBtn.style.pointerEvents = "none";
            glitchLayers.forEach(function (layer) {
              if (layer.parentElement.parentElement.classList[0] !== "slide__info") {
                layer.classList.add("quest".concat(current + 1));
                layer.style.background = "url(\"../img/quests/slide".concat(current + 1, "/pers.png\") no-repeat 0 0/contain");
              } else {
                layer.classList.add("slide-info-glitch");
              }
            });
            // slide.classList.remove("glitch")

            setTimeout(function () {
              icon.classList.add("_current");
              glitchLayers.forEach(function (layer) {
                layer.classList.forEach(function (className) {
                  if (className.startsWith("slide-info-glitch")) {
                    layer.classList.remove("slide-info-glitch");
                  }
                  if (className.startsWith("quest")) {
                    layer.classList.remove(className);
                  }
                });
              });
              rightBtn.style.pointerEvents = "initial";
              leftBtn.style.pointerEvents = "initial";
              slides.forEach(function (item, i) {
                item.classList.remove("glitch");
                if (i === current) {
                  item.classList.add("_active");
                } else {
                  item.classList.remove("_active");
                }
              });
              // slide.classList.add("_active")
            }, 1000);
          }
        });
      }
    });
  });
  SlideIconsInit(slidesIcons, current);
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwic2xpZGVzIiwicXVlcnlTZWxlY3RvckFsbCIsImxlZnRCdG4iLCJxdWVyeVNlbGVjdG9yIiwicmlnaHRCdG4iLCJzbGlkZXNJY29ucyIsImdsaXRjaExheWVycyIsImZvckVhY2giLCJzbGlkZSIsImN1cnJlbnQiLCJpIiwiY2xhc3NMaXN0IiwiYWRkIiwibW92ZVNsaWRlciIsImRpcmVjdGlvbiIsInJlbW92ZSIsImxlbmd0aCIsIlNsaWRlSWNvbnNJbml0IiwibGF5ZXIiLCJwYXJlbnRFbGVtZW50Iiwic3R5bGUiLCJiYWNrZ3JvdW5kIiwicG9pbnRlckV2ZW50cyIsInNldFRpbWVvdXQiLCJjbGFzc05hbWUiLCJzdGFydHNXaXRoIiwiaWNvbnMiLCJpY29uIiwiaWNvbkluZGV4IiwiZSIsIml0ZW0iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUFBLFFBQVEsQ0FBQ0MsZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUUsWUFBSztFQUkvQztFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0VBRUEsSUFBTUMsTUFBTSxHQUFHRixRQUFRLENBQUNHLGdCQUFnQixDQUFDLFFBQVEsQ0FBQztFQUNsRCxJQUFNQyxPQUFPLEdBQUdKLFFBQVEsQ0FBQ0ssYUFBYSxDQUFDLG1CQUFtQixDQUFDO0VBQzNELElBQU1DLFFBQVEsR0FBR04sUUFBUSxDQUFDSyxhQUFhLENBQUMsb0JBQW9CLENBQUM7RUFDN0QsSUFBTUUsV0FBVyxHQUFHUCxRQUFRLENBQUNHLGdCQUFnQixDQUFDLHFCQUFxQixDQUFDO0VBRXBFLElBQUlLLFlBQVksR0FBRyxFQUFFO0VBRXJCTixNQUFNLENBQUNPLE9BQU8sQ0FBQyxVQUFBQyxLQUFLLEVBQUc7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QUNqQyxJQUFHQSxTQUFTLENBQUNDLFVBQVUsQ0FBQyxtQkFBbUIsQ0FBQyxFQUFDO29CQUN6Q1AsS0FBSyxDQUFDUCxTQUFTLENBQUNJLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQztrQkFDL0M7a0JBQ0EsSUFBSVMsU0FBUyxDQUFDQyxVQUFVLENBQUMsT0FBTyxDQUFDLEVBQUU7b0JBQy9CUCxLQUFLLENBQUNQLFNBQVMsQ0FBQ0ksTUFBTSxDQUFDUyxTQUFTLENBQUM7a0JBQ3JDO2dCQUNKLENBQUMsQ0FBQztjQUNOLENBQUMsQ0FBQztjQUNGcEIsUUFBUSxDQUFDZ0IsS0FBSyxDQUFDRSxhQUFhLEdBQUcsU0FBUztjQUN4Q3BCLE9BQU8sQ0FBQ2tCLEtBQUssQ0FBQ0UsYUFBYSxHQUFHLFNBQVM7Y0FDdkN0QixNQUFNLENBQUNPLE9BQU8sQ0FBQyxVQUFDdUIsSUFBSSxFQUFFcEIsQ0FBQyxFQUFJO2dCQUN2Qm9CLElBQUksQ0FBQ25CLFNBQVMsQ0FBQ0ksTUFBTSxDQUFDLFFBQVEsQ0FBQztnQkFDL0IsSUFBR0wsQ0FBQyxLQUFLRCxPQUFPLEVBQUM7a0JBQ2JxQixJQUFJLENBQUNuQixTQUFTLENBQUNDLEdBQUcsQ0FBQyxTQUFTLENBQUM7Z0JBQ2pDLENBQUMsTUFDRztrQkFDQWtCLElBQUksQ0FBQ25CLFNBQVMsQ0FBQ0ksTUFBTSxDQUFDLFNBQVMsQ0FBQztnQkFDcEM7Y0FDSixDQUFDLENBQUM7Y0FDRjtZQUdKLENBQUMsRUFBRSxJQUFJLENBQUM7VUFFWjtRQUNKLENBQUMsQ0FBQztNQUNOO0lBQ0osQ0FBQyxDQUFDO0VBQ04sQ0FBQyxDQUFDO0VBRUZFLGNBQWMsQ0FBQ1osV0FBVyxFQUFFSSxPQUFPLENBQUM7QUFFcEMsQ0FBQyxDQUFDIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PntcblxuXG5cbiAgICAvLyBsZXQgd2VlayA9IDI7XG4gICAgLy9cbiAgICAvLyBpZih3ZWVrID09PSAxKXtcbiAgICAvLyAgICAgc2xpZGVzLmZvckVhY2goKHNsaWRlLCBpKSA9PntcbiAgICAvL1xuICAgIC8vICAgICAgICAgaWYoaSA+PSA2IHx8IHNsaWRlLmNsYXNzTGlzdC5jb250YWlucyhgcXVlc3Qke2l9YCkpe1xuICAgIC8vICAgICAgICAgICAgIHNsaWRlLnJlbW92ZSgpXG4gICAgLy8gICAgICAgICB9XG4gICAgLy8gICAgIH0pXG4gICAgLy8gICAgIHNsaWRlc0ljb25zLmZvckVhY2goKGljb24sIGkpID0+e1xuICAgIC8vICAgICAgICAgaWYoaSA+PSA2IHx8IGljb24uY2xhc3NMaXN0LmNvbnRhaW5zKGBxdWVzdCR7aX1gKSl7XG4gICAgLy8gICAgICAgICAgICAgaWNvbi5yZW1vdmUoKVxuICAgIC8vICAgICAgICAgfVxuICAgIC8vICAgICB9KVxuICAgIC8vIH1cbiAgICAvLyBpZih3ZWVrID09PSAyKXtcbiAgICAvLyAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gNjsgaSsrKXtcbiAgICAvLyAgICAgICAgIGxldCB3ZWVrMSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYC5xdWVzdCR7aX1gKVxuICAgIC8vICAgICAgICAgd2VlazEuZm9yRWFjaChpdGVtID0+IHtcbiAgICAvLyAgICAgICAgICAgICBpdGVtLnJlbW92ZSgpXG4gICAgLy8gICAgICAgICB9KVxuICAgIC8vXG4gICAgLy8gICAgIH1cbiAgICAvLyB9XG5cbiAgICBjb25zdCBzbGlkZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnNsaWRlXCIpXG4gICAgY29uc3QgbGVmdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2xpZGVfX21vdmUtbGVmdFwiKVxuICAgIGNvbnN0IHJpZ2h0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zbGlkZV9fbW92ZS1yaWdodFwiKVxuICAgIGNvbnN0IHNsaWRlc0ljb25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5xdWVzdHNfX2ljb25zLWl0ZW1cIilcblxuICAgIGxldCBnbGl0Y2hMYXllcnMgPSBbXTtcblxuICAgIHNsaWRlcy5mb3JFYWNoKHNsaWRlID0+e1xuICAgICAgICBnbGl0Y2hMYXllcnMgPSAgWy4uLmdsaXRjaExheWVycywgLi4uc2xpZGUucXVlcnlTZWxlY3RvckFsbChcIi5nbGl0Y2hfX2xheWVyXCIpXVxuICAgIH0pXG4gICAgbGV0IGN1cnJlbnQgPSAxXG4gICAgc2xpZGVzLmZvckVhY2goKHNsaWRlLCBpKSA9PntcbiAgICAgICAgaWYgKGkgPT09IGN1cnJlbnQpe1xuICAgICAgICAgICAgc2xpZGUuY2xhc3NMaXN0LmFkZChcIl9hY3RpdmVcIilcbiAgICAgICAgfVxuICAgIH0pXG4gICAgZnVuY3Rpb24gbW92ZVNsaWRlciAoc2xpZGVzLCBkaXJlY3Rpb24pIHtcbiAgICAgICAgaWYoZGlyZWN0aW9uID09PSBcImxlZnRcIil7XG4gICAgICAgICAgICAtLWN1cnJlbnRcbiAgICAgICAgICAgIHNsaWRlcy5mb3JFYWNoKChzbGlkZSwgaSkgPT57XG4gICAgICAgICAgICAgICAgc2xpZGUuY2xhc3NMaXN0LnJlbW92ZShcIl9hY3RpdmVcIiwgXCJnbGl0Y2hcIilcbiAgICAgICAgICAgICAgICBpZihjdXJyZW50IDwgMCkgY3VycmVudCA9IHNsaWRlcy5sZW5ndGggLSAxXG4gICAgICAgICAgICAgICAgaWYoaSA9PT0gY3VycmVudCkge1xuICAgICAgICAgICAgICAgICAgICBzbGlkZS5jbGFzc0xpc3QuYWRkKFwiX2FjdGl2ZVwiKVxuICAgICAgICAgICAgICAgICAgICBzbGlkZS5jbGFzc0xpc3QucmVtb3ZlKFwiZ2xpdGNoXCIpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICBpZihkaXJlY3Rpb24gPT09IFwicmlnaHRcIil7XG4gICAgICAgICAgICArK2N1cnJlbnRcbiAgICAgICAgICAgIHNsaWRlcy5mb3JFYWNoKChzbGlkZSwgaSkgPT57XG4gICAgICAgICAgICAgICAgc2xpZGUuY2xhc3NMaXN0LnJlbW92ZShcIl9hY3RpdmVcIiwgXCJnbGl0Y2hcIilcbiAgICAgICAgICAgICAgICBpZihjdXJyZW50ID4gc2xpZGVzLmxlbmd0aCAtIDEpIGN1cnJlbnQgPSAwXG4gICAgICAgICAgICAgICAgaWYoaSA9PT0gY3VycmVudCkge1xuICAgICAgICAgICAgICAgICAgICBzbGlkZS5jbGFzc0xpc3QuYWRkKFwiX2FjdGl2ZVwiKVxuICAgICAgICAgICAgICAgICAgICBzbGlkZS5jbGFzc0xpc3QucmVtb3ZlKFwiZ2xpdGNoXCIpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICBTbGlkZUljb25zSW5pdChzbGlkZXNJY29ucywgY3VycmVudClcblxuICAgIH1cblxubGVmdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICBzbGlkZXNbY3VycmVudF0uY2xhc3NMaXN0LmFkZChcImdsaXRjaFwiKVxuICAgICAgICBpZihjdXJyZW50ID09PSAwKXtcbiAgICAgICAgICAgIGdsaXRjaExheWVycy5mb3JFYWNoKGxheWVyID0+IHtcbiAgICAgICAgICAgICAgICBpZihsYXllci5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0WzBdICE9PSBcInNsaWRlX19pbmZvXCIpe1xuICAgICAgICAgICAgICAgICAgICBsYXllci5jbGFzc0xpc3QuYWRkKGBxdWVzdCR7c2xpZGVzLmxlbmd0aH1gKVxuICAgICAgICAgICAgICAgICAgICBsYXllci5zdHlsZS5iYWNrZ3JvdW5kID0gYHVybChcIi4uL2ltZy9xdWVzdHMvc2xpZGUke3NsaWRlcy5sZW5ndGh9L3BlcnMucG5nXCIpIG5vLXJlcGVhdCAwIDAvY29udGFpbmA7XG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5hZGQoXCJzbGlkZS1pbmZvLWdsaXRjaFwiKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZXtcbiAgICAgICAgICAgIGdsaXRjaExheWVycy5mb3JFYWNoKGxheWVyID0+IHtcbiAgICAgICAgICAgICAgICBpZihsYXllci5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0WzBdICE9PSBcInNsaWRlX19pbmZvXCIpe1xuICAgICAgICAgICAgICAgICAgICBsYXllci5jbGFzc0xpc3QuYWRkKGBxdWVzdCR7Y3VycmVudH1gKVxuICAgICAgICAgICAgICAgICAgICBsYXllci5zdHlsZS5iYWNrZ3JvdW5kID0gYHVybChcIi4uL2ltZy9xdWVzdHMvc2xpZGUke2N1cnJlbnR9L3BlcnMucG5nXCIpIG5vLXJlcGVhdCAwIDAvY29udGFpbmA7XG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5hZGQoXCJzbGlkZS1pbmZvLWdsaXRjaFwiKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJpZ2h0QnRuLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIlxuICAgICAgICBsZWZ0QnRuLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIlxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+e1xuICAgICAgICAgICAgZ2xpdGNoTGF5ZXJzLmZvckVhY2goKGxheWVyKSA9PiB7XG4gICAgICAgICAgICAgICAgbGF5ZXIuY2xhc3NMaXN0LmZvckVhY2goY2xhc3NOYW1lID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYoY2xhc3NOYW1lLnN0YXJ0c1dpdGgoXCJzbGlkZS1pbmZvLWdsaXRjaFwiKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXllci5jbGFzc0xpc3QucmVtb3ZlKFwic2xpZGUtaW5mby1nbGl0Y2hcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNsYXNzTmFtZS5zdGFydHNXaXRoKFwicXVlc3RcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBtb3ZlU2xpZGVyKHNsaWRlcywgXCJsZWZ0XCIpXG4gICAgICAgICAgICByaWdodEJ0bi5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJpbml0aWFsXCJcbiAgICAgICAgICAgIGxlZnRCdG4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiaW5pdGlhbFwiXG5cbiAgICAgICAgfSwgMTAwMClcbiAgICB9KVxucmlnaHRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsKCkgPT4gIHtcbiAgICBzbGlkZXNbY3VycmVudF0uY2xhc3NMaXN0LmFkZChcImdsaXRjaFwiKVxuICAgIHJpZ2h0QnRuLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIlxuICAgIGxlZnRCdG4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiXG4gICAgaWYoY3VycmVudCA9PT0gc2xpZGVzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgZ2xpdGNoTGF5ZXJzLmZvckVhY2gobGF5ZXIgPT57XG4gICAgICAgICAgICBpZihsYXllci5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0WzBdICE9PSBcInNsaWRlX19pbmZvXCIpe1xuICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5hZGQoYHF1ZXN0MWApXG4gICAgICAgICAgICAgICAgbGF5ZXIuc3R5bGUuYmFja2dyb3VuZCA9IGB1cmwoXCIuLi9pbWcvcXVlc3RzL3NsaWRlMS9wZXJzLnBuZ1wiKSBuby1yZXBlYXQgMCAwL2NvbnRhaW5gXG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICBsYXllci5jbGFzc0xpc3QuYWRkKFwic2xpZGUtaW5mby1nbGl0Y2hcIilcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG4gICAgZWxzZXtcbiAgICAgICAgY3VycmVudCArPSAyXG4gICAgICAgIGdsaXRjaExheWVycy5mb3JFYWNoKGxheWVyID0+e1xuICAgICAgICAgICAgICAgIGlmKGxheWVyLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5jbGFzc0xpc3RbMF0gIT09IFwic2xpZGVfX2luZm9cIil7XG4gICAgICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5hZGQoYHF1ZXN0JHtjdXJyZW50fWApXG4gICAgICAgICAgICAgICAgICAgIGxheWVyLnN0eWxlLmJhY2tncm91bmQgPSBgdXJsKFwiLi4vaW1nL3F1ZXN0cy9zbGlkZSR7Y3VycmVudH0vcGVycy5wbmdcIikgbm8tcmVwZWF0IDAgMC9jb250YWluYFxuICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgbGF5ZXIuY2xhc3NMaXN0LmFkZChcInNsaWRlLWluZm8tZ2xpdGNoXCIpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICBjdXJyZW50IC09IDJcbiAgICB9XG4gICAgc2V0VGltZW91dCgoKSA9PntcbiAgICAgICAgZ2xpdGNoTGF5ZXJzLmZvckVhY2goKGxheWVyKSA9PiB7XG4gICAgICAgICAgICBsYXllci5jbGFzc0xpc3QuZm9yRWFjaChjbGFzc05hbWUgPT4ge1xuICAgICAgICAgICAgICAgIGlmKGNsYXNzTmFtZS5zdGFydHNXaXRoKFwic2xpZGUtaW5mby1nbGl0Y2hcIikpe1xuICAgICAgICAgICAgICAgICAgICBsYXllci5jbGFzc0xpc3QucmVtb3ZlKFwic2xpZGUtaW5mby1nbGl0Y2hcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjbGFzc05hbWUuc3RhcnRzV2l0aChcInF1ZXN0XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIG1vdmVTbGlkZXIoc2xpZGVzLCBcInJpZ2h0XCIpXG4gICAgICAgIHJpZ2h0QnRuLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcImluaXRpYWxcIlxuICAgICAgICBsZWZ0QnRuLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcImluaXRpYWxcIlxuXG4gICAgfSwgMTAwMClcbn0pXG5cbmZ1bmN0aW9uIFNsaWRlSWNvbnNJbml0KGljb25zLCBjdXJyZW50KXtcbiAgICAgICAgLy8gc2xpZGVzLmZvckVhY2goKHNsaWRlLCBzbGlkZUluZGV4KSA9PiB7XG4gICAgICAgIC8vICAgICBpY29ucy5mb3JFYWNoKChpY29uLCBpY29uSW5kZXgpID0+e1xuICAgICAgICAvLyAgICAgICAgIGlmIChjdXJyZW50ID09KVxuICAgICAgICAvLyAgICAgfSlcbiAgICAgICAgLy8gfSlcbiAgICAgICAgaWNvbnMuZm9yRWFjaCgoaWNvbiwgaWNvbkluZGV4KSA9PntcbiAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LnJlbW92ZShcIl9jdXJyZW50XCIpXG4gICAgICAgICAgICBpZiAoY3VycmVudCA9PT0gaWNvbkluZGV4KXtcbiAgICAgICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5hZGQoXCJfY3VycmVudFwiKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxufVxuXG5zbGlkZXNJY29ucy5mb3JFYWNoKChpY29uLCBpKSA9PntcbiAgICBpY29uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT57XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT57XG4gICAgICAgICAgICBzbGlkZXNJY29ucy5mb3JFYWNoKGl0ZW0gPT57XG4gICAgICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKFwiX2N1cnJlbnRcIilcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sIDEwMDApXG5cbiAgICAgICAgc2xpZGVzW2N1cnJlbnRdLmNsYXNzTGlzdC5hZGQoXCJnbGl0Y2hcIilcbiAgICAgICAgY3VycmVudCA9IGlcbiAgICAgICAgaWYgKGkgPT09IGN1cnJlbnQpe1xuICAgICAgICAgICAgc2xpZGVzLmZvckVhY2goKHNsaWRlLCBpKSA9PntcbiAgICAgICAgICAgICAgICBpZihpID09PSBjdXJyZW50KXtcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRCdG4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiXG4gICAgICAgICAgICAgICAgICAgIGxlZnRCdG4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiXG4gICAgICAgICAgICAgICAgICAgIGdsaXRjaExheWVycy5mb3JFYWNoKGxheWVyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGxheWVyLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5jbGFzc0xpc3RbMF0gIT09IFwic2xpZGVfX2luZm9cIil7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXIuY2xhc3NMaXN0LmFkZChgcXVlc3Qke2N1cnJlbnQgKyAxfWApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXIuc3R5bGUuYmFja2dyb3VuZCA9IGB1cmwoXCIuLi9pbWcvcXVlc3RzL3NsaWRlJHtjdXJyZW50ICsgMX0vcGVycy5wbmdcIikgbm8tcmVwZWF0IDAgMC9jb250YWluYDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5hZGQoXCJzbGlkZS1pbmZvLWdsaXRjaFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2xpZGUuY2xhc3NMaXN0LnJlbW92ZShcImdsaXRjaFwiKVxuXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT57XG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5hZGQoXCJfY3VycmVudFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgZ2xpdGNoTGF5ZXJzLmZvckVhY2goKGxheWVyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXIuY2xhc3NMaXN0LmZvckVhY2goY2xhc3NOYW1lID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoY2xhc3NOYW1lLnN0YXJ0c1dpdGgoXCJzbGlkZS1pbmZvLWdsaXRjaFwiKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXllci5jbGFzc0xpc3QucmVtb3ZlKFwic2xpZGUtaW5mby1nbGl0Y2hcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNsYXNzTmFtZS5zdGFydHNXaXRoKFwicXVlc3RcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByaWdodEJ0bi5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJpbml0aWFsXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnRCdG4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiaW5pdGlhbFwiXG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXMuZm9yRWFjaCgoaXRlbSwgaSkgPT57XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKFwiZ2xpdGNoXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaSA9PT0gY3VycmVudCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZChcIl9hY3RpdmVcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKFwiX2FjdGl2ZVwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzbGlkZS5jbGFzc0xpc3QuYWRkKFwiX2FjdGl2ZVwiKVxuXG5cbiAgICAgICAgICAgICAgICAgICAgfSwgMTAwMClcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9KVxufSlcblxuU2xpZGVJY29uc0luaXQoc2xpZGVzSWNvbnMsIGN1cnJlbnQpXG5cbn0pXG5cbiJdfQ==
