"use strict";

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
document.addEventListener("DOMContentLoaded", function () {
  var slides = document.querySelectorAll(".slide");
  var leftBtn = document.querySelector(".slide__move-left");
  var rightBtn = document.querySelector(".slide__move-right");
  var slidesIcons = document.querySelectorAll(".quests__icons-item");
  var glitchLayers = [];
  var current = 1;
  // let week = 2;
  var week = localStorage.getItem("week") ? parseInt(localStorage.getItem("week")) : 1;
  if (week === 1) {
    slides.forEach(function (slide, i) {
      if (i >= 6 || slide.classList.contains("quest".concat(i))) {
        slide.remove();
      }
    });
    slidesIcons.forEach(function (icon, i) {
      if (i >= 6 || icon.classList.contains("quest".concat(i))) {
        icon.remove();
      }
    });
  }
  if (week === 2) {
    for (var i = 1; i <= 6; i++) {
      var _week = document.querySelectorAll(".quest".concat(i));
      _week.forEach(function (item) {
        item.remove();
      });
    }
  }
  slides.forEach(function (slide) {
    glitchLayers = [].concat(_toConsumableArray(glitchLayers), _toConsumableArray(slide.querySelectorAll(".glitch__layer")));
  });
  slides[current].classList.add("_active");
  function updateGlitchLayers(index) {
    if (week === 2) {
      index += 6;
    }
    glitchLayers.forEach(function (layer) {
      layer.classList.forEach(function (className) {
        if (className.startsWith("slide-info-glitch")) {
          layer.classList.remove("slide-info-glitch");
        }
        if (className.startsWith("quest")) {
          layer.classList.remove(className);
        }
      });
      if (layer.parentElement.parentElement.classList[0] !== "slide__info") {
        layer.classList.add("quest".concat(index));
        layer.style.background = "url(\"../img/quests/slide".concat(index, "/pers.png\") no-repeat 0 0/contain");
      } else {
        layer.classList.add("slide-info-glitch");
      }
    });
  }
  function moveSlider(slides, direction) {
    if (direction === "left") {
      --current;
      if (current < 0) current = slides.length - 1;
    } else if (direction === "right") {
      ++current;
      if (current > slides.length - 1) current = 0;
    }
    slides.forEach(function (slide, i) {
      slide.classList.toggle("_active", i === current);
      slide.classList.remove("glitch");
    });
    SlideIconsInit(slidesIcons, current);
  }
  function SlideIconsInit(icons, current) {
    icons.forEach(function (icon, iconIndex) {
      icon.classList.toggle("_current", current === iconIndex);
    });
  }
  function handleClick(direction) {
    slides[current].classList.add("glitch");
    rightBtn.style.pointerEvents = "none";
    leftBtn.style.pointerEvents = "none";
    var nextSlideIndex = direction === "left" ? current === 0 ? slides.length : current : current === slides.length - 1 ? 1 : current + 2;
    updateGlitchLayers(nextSlideIndex);
    setTimeout(function () {
      glitchLayers.forEach(function (layer) {
        layer.classList.forEach(function (className) {
          if (className.startsWith("slide-info-glitch") || className.startsWith("quest")) {
            layer.classList.remove(className);
          }
        });
      });
      moveSlider(slides, direction);
      rightBtn.style.pointerEvents = "initial";
      leftBtn.style.pointerEvents = "initial";
    }, 1000);
  }
  leftBtn.addEventListener("click", function () {
    return handleClick("left");
  });
  rightBtn.addEventListener("click", function () {
    return handleClick("right");
  });
  slidesIcons.forEach(function (icon, i) {
    icon.addEventListener("click", function () {
      setTimeout(function () {
        slidesIcons.forEach(function (item) {
          return item.classList.remove("_current");
        });
      }, 1000);
      slides[current].classList.add("glitch");
      current = i;
      updateGlitchLayers(current + 1);
      setTimeout(function () {
        SlideIconsInit(slidesIcons, current);
        slides.forEach(function (slide, index) {
          slide.classList.toggle("_active", index === current);
          slide.classList.remove("glitch");
        });
        rightBtn.style.pointerEvents = "initial";
        leftBtn.style.pointerEvents = "initial";
      }, 1000);
    });
  });
  SlideIconsInit(slidesIcons, current);

  // for test

  var week1 = document.querySelector(".week1");
  var week2 = document.querySelector(".week2");
  week1.addEventListener("click", function () {
    localStorage.setItem("week", 1);
    location.reload();
  });
  week2.addEventListener("click", function () {
    localStorage.setItem("week", 2);
    location.reload();
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwic2xpZGVzIiwicXVlcnlTZWxlY3RvckFsbCIsImxlZnRCdG4iLCJxdWVyeVNlbGVjdG9yIiwicmlnaHRCdG4iLCJzbGlkZXNJY29ucyIsImdsaXRjaExheWVycyIsImN1cnJlbnQiLCJ3ZWVrIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInBhcnNlSW50IiwiZm9yRWFjaCIsInNsaWRlIiwiaSIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwicmVtb3ZlIiwiaWNvbiIsIndlZWsxIiwiaXRlbSIsImFkZCIsInVwZGF0ZUdsaXRjaExheWVycyIsImluZGV4IiwibGF5ZXIiLCJjbGFzc05hbWUiLCJzdGFydHNXaXRoIiwicGFyZW50RWxlbWVudCIsInN0eWxlIiwiYmFja2dyb3VuZCIsIm1vdmVTbGlkZXIiLCJkaXJlY3Rpb24iLCJsZW5ndGgiLCJ0b2dnbGUiLCJTbGlkZUljb25zSW5pdCIsImljb25zIiwiaWNvbkluZGV4IiwiaGFuZGxlQ2xpY2siLCJwb2ludGVyRXZlbnRzIiwibmV4dFNsaWRlSW5kZXgiLCJzZXRUaW1lb3V0Iiwid2VlazIiLCJzZXRJdGVtIiwibG9jYXRpb24iLCJyZWxvYWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUFBLFFBQVEsQ0FBQ0MsZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUUsWUFBSztFQUkvQyxJQUFNQyxNQUFNLEdBQUdGLFFBQVEsQ0FBQ0csZ0JBQWdCLENBQUMsUUFBUSxDQUFDO0VBQ2xELElBQU1DLE9BQU8sR0FBR0osUUFBUSxDQUFDSyxhQUFhLENBQUMsbUJBQW1CLENBQUM7RUFDM0QsSUFBTUMsUUFBUSxHQUFHTixRQUFRLENBQUNLLGFBQWEsQ0FBQyxvQkFBb0IsQ0FBQztFQUM3RCxJQUFNRSxXQUFXLEdBQUdQLFFBQVEsQ0FBQ0csZ0JBQWdCLENBQUMscUJBQXFCLENBQUM7RUFFcEUsSUFBSUssWUFBWSxHQUFHLEVBQUU7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QVEsQ0FBQ0MsTUFBTSxFQUFFO0VBQ3JCLENBQUMsQ0FBQztFQUVGSCxLQUFLLENBQUMxQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBTTtJQUNsQ1UsWUFBWSxDQUFDaUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDL0JDLFFBQVEsQ0FBQ0MsTUFBTSxFQUFFO0VBQ3JCLENBQUMsQ0FBQztBQUdOLENBQUMsQ0FBQyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT57XG5cblxuXG4gICAgY29uc3Qgc2xpZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zbGlkZVwiKTtcbiAgICBjb25zdCBsZWZ0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zbGlkZV9fbW92ZS1sZWZ0XCIpO1xuICAgIGNvbnN0IHJpZ2h0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zbGlkZV9fbW92ZS1yaWdodFwiKTtcbiAgICBjb25zdCBzbGlkZXNJY29ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucXVlc3RzX19pY29ucy1pdGVtXCIpO1xuXG4gICAgbGV0IGdsaXRjaExheWVycyA9IFtdO1xuICAgIGxldCBjdXJyZW50ID0gMTtcbiAgICAvLyBsZXQgd2VlayA9IDI7XG4gICAgbGV0IHdlZWsgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcIndlZWtcIikgPyBwYXJzZUludChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcIndlZWtcIikpIDogMTtcblxuICAgIGlmKHdlZWsgPT09IDEpe1xuICAgICAgICBzbGlkZXMuZm9yRWFjaCgoc2xpZGUsIGkpID0+e1xuXG4gICAgICAgICAgICBpZihpID49IDYgfHwgc2xpZGUuY2xhc3NMaXN0LmNvbnRhaW5zKGBxdWVzdCR7aX1gKSl7XG4gICAgICAgICAgICAgICAgc2xpZGUucmVtb3ZlKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgc2xpZGVzSWNvbnMuZm9yRWFjaCgoaWNvbiwgaSkgPT57XG4gICAgICAgICAgICBpZihpID49IDYgfHwgaWNvbi5jbGFzc0xpc3QuY29udGFpbnMoYHF1ZXN0JHtpfWApKXtcbiAgICAgICAgICAgICAgICBpY29uLnJlbW92ZSgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfVxuICAgIGlmKHdlZWsgPT09IDIpe1xuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSA2OyBpKyspe1xuICAgICAgICAgICAgbGV0IHdlZWsxID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLnF1ZXN0JHtpfWApXG4gICAgICAgICAgICB3ZWVrMS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgICAgICAgIGl0ZW0ucmVtb3ZlKClcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNsaWRlcy5mb3JFYWNoKHNsaWRlID0+IHtcbiAgICAgICAgZ2xpdGNoTGF5ZXJzID0gWy4uLmdsaXRjaExheWVycywgLi4uc2xpZGUucXVlcnlTZWxlY3RvckFsbChcIi5nbGl0Y2hfX2xheWVyXCIpXTtcbiAgICB9KTtcblxuICAgIHNsaWRlc1tjdXJyZW50XS5jbGFzc0xpc3QuYWRkKFwiX2FjdGl2ZVwiKTtcblxuICAgIGZ1bmN0aW9uIHVwZGF0ZUdsaXRjaExheWVycyhpbmRleCkge1xuICAgICAgICBpZih3ZWVrID09PSAyKXtcbiAgICAgICAgICAgIGluZGV4ICs9IDZcbiAgICAgICAgfVxuICAgICAgICBnbGl0Y2hMYXllcnMuZm9yRWFjaChsYXllciA9PiB7XG4gICAgICAgICAgICBsYXllci5jbGFzc0xpc3QuZm9yRWFjaChjbGFzc05hbWUgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjbGFzc05hbWUuc3RhcnRzV2l0aChcInNsaWRlLWluZm8tZ2xpdGNoXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5yZW1vdmUoXCJzbGlkZS1pbmZvLWdsaXRjaFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNsYXNzTmFtZS5zdGFydHNXaXRoKFwicXVlc3RcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgbGF5ZXIuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGxheWVyLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5jbGFzc0xpc3RbMF0gIT09IFwic2xpZGVfX2luZm9cIikge1xuICAgICAgICAgICAgICAgIGxheWVyLmNsYXNzTGlzdC5hZGQoYHF1ZXN0JHtpbmRleH1gKTtcbiAgICAgICAgICAgICAgICBsYXllci5zdHlsZS5iYWNrZ3JvdW5kID0gYHVybChcIi4uL2ltZy9xdWVzdHMvc2xpZGUke2luZGV4fS9wZXJzLnBuZ1wiKSBuby1yZXBlYXQgMCAwL2NvbnRhaW5gO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsYXllci5jbGFzc0xpc3QuYWRkKFwic2xpZGUtaW5mby1nbGl0Y2hcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1vdmVTbGlkZXIoc2xpZGVzLCBkaXJlY3Rpb24pIHtcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gXCJsZWZ0XCIpIHtcbiAgICAgICAgICAgIC0tY3VycmVudDtcbiAgICAgICAgICAgIGlmIChjdXJyZW50IDwgMCkgY3VycmVudCA9IHNsaWRlcy5sZW5ndGggLSAxO1xuICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gXCJyaWdodFwiKSB7XG4gICAgICAgICAgICArK2N1cnJlbnQ7XG4gICAgICAgICAgICBpZiAoY3VycmVudCA+IHNsaWRlcy5sZW5ndGggLSAxKSBjdXJyZW50ID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIHNsaWRlcy5mb3JFYWNoKChzbGlkZSwgaSkgPT4ge1xuICAgICAgICAgICAgc2xpZGUuY2xhc3NMaXN0LnRvZ2dsZShcIl9hY3RpdmVcIiwgaSA9PT0gY3VycmVudCk7XG4gICAgICAgICAgICBzbGlkZS5jbGFzc0xpc3QucmVtb3ZlKFwiZ2xpdGNoXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBTbGlkZUljb25zSW5pdChzbGlkZXNJY29ucywgY3VycmVudCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gU2xpZGVJY29uc0luaXQoaWNvbnMsIGN1cnJlbnQpIHtcbiAgICAgICAgaWNvbnMuZm9yRWFjaCgoaWNvbiwgaWNvbkluZGV4KSA9PiB7XG4gICAgICAgICAgICBpY29uLmNsYXNzTGlzdC50b2dnbGUoXCJfY3VycmVudFwiLCBjdXJyZW50ID09PSBpY29uSW5kZXgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVDbGljayhkaXJlY3Rpb24pIHtcbiAgICAgICAgc2xpZGVzW2N1cnJlbnRdLmNsYXNzTGlzdC5hZGQoXCJnbGl0Y2hcIik7XG4gICAgICAgIHJpZ2h0QnRuLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIjtcbiAgICAgICAgbGVmdEJ0bi5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7XG4gICAgICAgIGNvbnN0IG5leHRTbGlkZUluZGV4ID0gZGlyZWN0aW9uID09PSBcImxlZnRcIiA/IChjdXJyZW50ID09PSAwID8gc2xpZGVzLmxlbmd0aCA6IGN1cnJlbnQpIDogKGN1cnJlbnQgPT09IHNsaWRlcy5sZW5ndGggLSAxID8gMSA6IGN1cnJlbnQgKyAyKTtcbiAgICAgICAgdXBkYXRlR2xpdGNoTGF5ZXJzKG5leHRTbGlkZUluZGV4KTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBnbGl0Y2hMYXllcnMuZm9yRWFjaChsYXllciA9PiB7XG4gICAgICAgICAgICAgICAgbGF5ZXIuY2xhc3NMaXN0LmZvckVhY2goY2xhc3NOYW1lID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNsYXNzTmFtZS5zdGFydHNXaXRoKFwic2xpZGUtaW5mby1nbGl0Y2hcIikgfHwgY2xhc3NOYW1lLnN0YXJ0c1dpdGgoXCJxdWVzdFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXIuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG1vdmVTbGlkZXIoc2xpZGVzLCBkaXJlY3Rpb24pO1xuICAgICAgICAgICAgcmlnaHRCdG4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiaW5pdGlhbFwiO1xuICAgICAgICAgICAgbGVmdEJ0bi5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJpbml0aWFsXCI7XG4gICAgICAgIH0sIDEwMDApO1xuICAgIH1cblxuICAgIGxlZnRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGhhbmRsZUNsaWNrKFwibGVmdFwiKSk7XG4gICAgcmlnaHRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGhhbmRsZUNsaWNrKFwicmlnaHRcIikpO1xuXG4gICAgc2xpZGVzSWNvbnMuZm9yRWFjaCgoaWNvbiwgaSkgPT4ge1xuICAgICAgICBpY29uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBzbGlkZXNJY29ucy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5jbGFzc0xpc3QucmVtb3ZlKFwiX2N1cnJlbnRcIikpO1xuICAgICAgICAgICAgfSwgMTAwMCk7XG5cbiAgICAgICAgICAgIHNsaWRlc1tjdXJyZW50XS5jbGFzc0xpc3QuYWRkKFwiZ2xpdGNoXCIpO1xuICAgICAgICAgICAgY3VycmVudCA9IGk7XG4gICAgICAgICAgICB1cGRhdGVHbGl0Y2hMYXllcnMoY3VycmVudCArIDEpO1xuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBTbGlkZUljb25zSW5pdChzbGlkZXNJY29ucywgY3VycmVudCk7XG4gICAgICAgICAgICAgICAgc2xpZGVzLmZvckVhY2goKHNsaWRlLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzbGlkZS5jbGFzc0xpc3QudG9nZ2xlKFwiX2FjdGl2ZVwiLCBpbmRleCA9PT0gY3VycmVudCk7XG4gICAgICAgICAgICAgICAgICAgIHNsaWRlLmNsYXNzTGlzdC5yZW1vdmUoXCJnbGl0Y2hcIik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmlnaHRCdG4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiaW5pdGlhbFwiO1xuICAgICAgICAgICAgICAgIGxlZnRCdG4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiaW5pdGlhbFwiO1xuICAgICAgICAgICAgfSwgMTAwMCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgU2xpZGVJY29uc0luaXQoc2xpZGVzSWNvbnMsIGN1cnJlbnQpO1xuXG4vLyBmb3IgdGVzdFxuXG4gICAgY29uc3Qgd2VlazEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLndlZWsxXCIpO1xuICAgIGNvbnN0IHdlZWsyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53ZWVrMlwiKTtcblxuICAgIHdlZWsxLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwid2Vla1wiLCAxKTtcbiAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgfSk7XG5cbiAgICB3ZWVrMi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcIndlZWtcIiwgMik7XG4gICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgIH0pO1xuXG5cbn0pXG5cbiJdfQ==
